<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ ~å±Šã‘ãŸã„ã€ã“ã®æ°—æŒã¡~</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Zen+Old+Mincho&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #1a0a1e;
  overflow: hidden;
  font-family: 'Zen Maru Gothic', sans-serif;
  user-select: none;
}

#game {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
}

/* èƒŒæ™¯ */
#bg {
  position: absolute;
  inset: 0;
  transition: opacity 0.8s ease;
}

.bg-classroom {
  background: linear-gradient(180deg, #87CEEB 0%, #B0E0E6 30%, #F5F5DC 30%, #FFF8DC 100%);
}

.bg-hallway {
  background: linear-gradient(180deg, #778899 0%, #B0C4DE 20%, #DEB887 35%, #D2B48C 100%);
}

.bg-rooftop {
  background: linear-gradient(180deg, #FF6B6B 0%, #FF8E8E 20%, #FFB4B4 40%, #FFF0F0 60%, #E8E8E8 60%, #D0D0D0 100%);
}

.bg-kitchen {
  background: linear-gradient(180deg, #FFF8E1 0%, #FFECB3 30%, #8D6E63 70%, #5D4037 100%);
}

.bg-park {
  background: linear-gradient(180deg, #FF7043 0%, #FFAB91 25%, #FFE0B2 50%, #81C784 65%, #4CAF50 100%);
}

/* èƒŒæ™¯è£…é£¾ */
.bg-detail {
  position: absolute;
  pointer-events: none;
}

/* æ•™å®¤ã®çª“ */
.window-frame {
  width: 120px; height: 150px;
  border: 6px solid #8B7355;
  background: rgba(135,206,235,0.3);
  top: 5%;
}
.window-frame:nth-child(1) { left: 10%; }
.window-frame:nth-child(2) { left: 35%; }
.window-frame:nth-child(3) { left: 60%; }

/* å»Šä¸‹ã®ãƒ­ãƒƒã‚«ãƒ¼ */
.locker {
  width: 60px; height: 120px;
  background: #A0A0A0;
  border: 2px solid #808080;
  bottom: 40%;
}

/* å±‹ä¸Šã®ãƒ•ã‚§ãƒ³ã‚¹ */
.fence {
  width: 100%; height: 3px;
  background: repeating-linear-gradient(90deg, #999 0px, #999 2px, transparent 2px, transparent 15px);
  top: 58%;
}

/* ãƒãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« */
.heart-particle {
  position: absolute;
  color: #FF69B4;
  font-size: 16px;
  pointer-events: none;
  animation: floatHeart 4s ease-in-out infinite;
  opacity: 0.6;
}

@keyframes floatHeart {
  0% { transform: translateY(0) rotate(0deg); opacity: 0; }
  20% { opacity: 0.6; }
  80% { opacity: 0.6; }
  100% { transform: translateY(-200px) rotate(20deg); opacity: 0; }
}

/* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */
#character {
  position: absolute;
  bottom: 12%;
  left: 50%;
  transform: translateX(-50%);
  transition: all 0.6s ease;
  z-index: 5;
}

.char-body {
  position: relative;
  width: 180px;
  height: 320px;
}

/* ã‚­ãƒ£ãƒ© - é¡” */
.char-face {
  width: 90px;
  height: 95px;
  background: #FFE4C4;
  border-radius: 45px 45px 40px 40px;
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}

.char-hair {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  width: 105px;
  height: 65px;
  background: #2C1810;
  border-radius: 52px 52px 10px 10px;
  z-index: 3;
}

.char-hair-side-l, .char-hair-side-r {
  position: absolute;
  top: 30px;
  width: 22px;
  height: 80px;
  background: #2C1810;
  border-radius: 0 0 10px 10px;
  z-index: 3;
}
.char-hair-side-l { left: 27px; }
.char-hair-side-r { right: 27px; }

.char-eye {
  position: absolute;
  width: 14px;
  height: 16px;
  background: #2C1810;
  border-radius: 50%;
  top: 38px;
  z-index: 4;
}
.char-eye.left { left: 55px; }
.char-eye.right { right: 55px; }

.char-eye-light {
  position: absolute;
  width: 5px;
  height: 5px;
  background: white;
  border-radius: 50%;
  top: 2px;
  right: 2px;
}

.char-mouth {
  position: absolute;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 4;
  transition: all 0.3s;
}

.mouth-normal {
  width: 12px;
  height: 6px;
  border-bottom: 2px solid #C4756B;
  border-radius: 0 0 6px 6px;
}

.mouth-smile {
  width: 18px;
  height: 10px;
  border-bottom: 2.5px solid #C4756B;
  border-radius: 0 0 10px 10px;
}

.mouth-surprise {
  width: 10px;
  height: 12px;
  background: #C4756B;
  border-radius: 50%;
}

.char-blush {
  position: absolute;
  width: 18px;
  height: 10px;
  background: rgba(255,100,100,0.4);
  border-radius: 50%;
  top: 50px;
  z-index: 4;
  opacity: 0;
  transition: opacity 0.5s;
}
.char-blush.left { left: 48px; }
.char-blush.right { right: 48px; }
.char-blush.visible { opacity: 1; }

/* åˆ¶æœ */
.char-uniform {
  position: absolute;
  top: 88px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 140px;
  background: #1B3A5C;
  border-radius: 10px 10px 0 0;
  z-index: 1;
}

.char-collar {
  position: absolute;
  top: 82px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 25px solid transparent;
  border-right: 25px solid transparent;
  border-top: 20px solid white;
  z-index: 2;
}

.char-ribbon {
  position: absolute;
  top: 88px;
  left: 50%;
  transform: translateX(-50%);
  width: 14px;
  height: 14px;
  background: #E74C3C;
  z-index: 3;
  clip-path: polygon(50% 0%, 0% 40%, 20% 100%, 50% 70%, 80% 100%, 100% 40%);
}

.char-skirt {
  position: absolute;
  top: 225px;
  left: 50%;
  transform: translateX(-50%);
  width: 110px;
  height: 55px;
  background: #1B3A5C;
  clip-path: polygon(5% 0%, 95% 0%, 100% 100%, 0% 100%);
  z-index: 1;
}

/* ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ */
#textbox {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  background: linear-gradient(180deg, rgba(20,0,30,0.85) 0%, rgba(40,10,50,0.95) 100%);
  border-top: 2px solid rgba(255,182,193,0.5);
  z-index: 20;
  padding: 20px 40px;
  display: flex;
  flex-direction: column;
}

#speaker {
  font-family: 'Zen Old Mincho', serif;
  color: #FFB6C1;
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 8px;
  min-height: 24px;
  text-shadow: 0 0 10px rgba(255,182,193,0.5);
}

#dialogue {
  font-family: 'Zen Maru Gothic', sans-serif;
  color: #F0E6F0;
  font-size: 17px;
  line-height: 1.8;
  flex: 1;
  letter-spacing: 0.5px;
}

#click-indicator {
  position: absolute;
  bottom: 15px;
  right: 30px;
  color: rgba(255,182,193,0.7);
  font-size: 14px;
  animation: blink 1.2s ease-in-out infinite;
}

@keyframes blink {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

/* é¸æŠè‚¢ */
#choices {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 30;
  display: none;
  flex-direction: column;
  gap: 16px;
  width: 500px;
  max-width: 90vw;
}

.choice-btn {
  background: linear-gradient(135deg, rgba(60,10,40,0.9) 0%, rgba(100,20,60,0.9) 100%);
  border: 2px solid rgba(255,182,193,0.5);
  color: #FFE4E8;
  padding: 16px 28px;
  font-size: 16px;
  font-family: 'Zen Maru Gothic', sans-serif;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  letter-spacing: 0.5px;
}

.choice-btn:hover {
  background: linear-gradient(135deg, rgba(120,30,70,0.95) 0%, rgba(180,50,100,0.95) 100%);
  border-color: #FF69B4;
  transform: translateX(8px);
  box-shadow: 0 0 20px rgba(255,105,180,0.3);
}

/* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
#title-screen {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, #1a0a1e 0%, #2d1033 30%, #4a1942 60%, #1a0a1e 100%);
  z-index: 50;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

#title-screen h1 {
  font-family: 'Zen Old Mincho', serif;
  color: #FFB6C1;
  font-size: 42px;
  text-shadow: 0 0 30px rgba(255,182,193,0.5), 0 0 60px rgba(255,105,180,0.3);
  margin-bottom: 12px;
  letter-spacing: 4px;
}

#title-screen .subtitle {
  font-family: 'Zen Old Mincho', serif;
  color: rgba(255,182,193,0.7);
  font-size: 18px;
  letter-spacing: 6px;
  margin-bottom: 60px;
}

#title-screen .start-text {
  color: rgba(255,228,225,0.6);
  font-size: 15px;
  animation: blink 1.5s ease-in-out infinite;
  letter-spacing: 2px;
}

.title-chocolate {
  font-size: 80px;
  margin-bottom: 30px;
  filter: drop-shadow(0 0 20px rgba(139,69,19,0.5));
}

/* æµ®éŠã™ã‚‹ãƒãƒ¼ãƒˆï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰ */
.title-heart {
  position: absolute;
  font-size: 24px;
  color: #FF69B4;
  opacity: 0.15;
  animation: titleFloat linear infinite;
}

@keyframes titleFloat {
  0% { transform: translateY(100vh) rotate(0deg); }
  100% { transform: translateY(-100px) rotate(360deg); }
}

/* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
#ending-screen {
  position: absolute;
  inset: 0;
  z-index: 50;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 40px;
}

.ending-good {
  background: linear-gradient(135deg, #1a0a1e 0%, #3d1144 30%, #6b2054 50%, #3d1144 70%, #1a0a1e 100%);
}

.ending-normal {
  background: linear-gradient(135deg, #1a0a1e 0%, #1e2340 50%, #1a0a1e 100%);
}

.ending-bad {
  background: linear-gradient(135deg, #0a0a1e 0%, #151530 50%, #0a0a1e 100%);
}

#ending-screen h2 {
  font-family: 'Zen Old Mincho', serif;
  font-size: 36px;
  margin-bottom: 30px;
  letter-spacing: 3px;
}

#ending-screen .ending-text {
  font-size: 17px;
  line-height: 2.2;
  color: #E8D8E8;
  max-width: 600px;
  margin-bottom: 50px;
}

#ending-screen .ending-label {
  font-family: 'Zen Old Mincho', serif;
  font-size: 14px;
  letter-spacing: 4px;
  margin-bottom: 40px;
}

.retry-btn {
  background: transparent;
  border: 1px solid rgba(255,182,193,0.5);
  color: #FFB6C1;
  padding: 12px 40px;
  font-size: 15px;
  font-family: 'Zen Maru Gothic', sans-serif;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  letter-spacing: 2px;
}

.retry-btn:hover {
  background: rgba(255,182,193,0.1);
  border-color: #FF69B4;
  box-shadow: 0 0 20px rgba(255,105,180,0.2);
}

/* ãƒãƒ§ã‚³æ¼”å‡º */
#chocolate-gift {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  z-index: 15;
  font-size: 120px;
  transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  filter: drop-shadow(0 0 30px rgba(139,69,19,0.6));
}

#chocolate-gift.show {
  transform: translate(-50%, -50%) scale(1);
}

/* ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
#transition {
  position: absolute;
  inset: 0;
  background: black;
  z-index: 40;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease;
}

#transition.active {
  opacity: 1;
  pointer-events: all;
}

/* å¥½æ„Ÿåº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
#affection-meter {
  position: absolute;
  top: 15px;
  right: 20px;
  z-index: 25;
  display: none;
  align-items: center;
  gap: 8px;
  background: rgba(20,0,30,0.7);
  padding: 8px 16px;
  border-radius: 20px;
  border: 1px solid rgba(255,182,193,0.3);
}

#affection-meter .heart-icon {
  color: #FF69B4;
  font-size: 18px;
}

#affection-bar {
  width: 100px;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
  overflow: hidden;
}

#affection-fill {
  height: 100%;
  width: 30%;
  background: linear-gradient(90deg, #FF69B4, #FF1493);
  border-radius: 4px;
  transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* CGæ¼”å‡ºç”¨ */
#cg-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
  display: none;
  align-items: center;
  justify-content: center;
}

.cg-sunset {
  background: radial-gradient(ellipse at 50% 80%, #FF6B35 0%, #FF4500 20%, #DC143C 40%, #8B0000 60%, #2C0033 80%);
}

.sakura-petal {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #FFB7C5;
  border-radius: 50% 0 50% 50%;
  opacity: 0.7;
  animation: sakuraFall linear infinite;
}

@keyframes sakuraFall {
  0% { transform: translateY(-20px) rotate(0deg) translateX(0); opacity: 0; }
  10% { opacity: 0.7; }
  90% { opacity: 0.7; }
  100% { transform: translateY(100vh) rotate(720deg) translateX(100px); opacity: 0; }
}
</style>
</head>
<body>
<div id="game">
  <!-- ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ -->
  <div id="transition"></div>

  <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
  <div id="title-screen">
    <div class="title-chocolate">ğŸ«</div>
    <h1>ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h1>
    <div class="subtitle">~ å±Šã‘ãŸã„ã€ã“ã®æ°—æŒã¡ ~</div>
    <div class="start-text">- ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ¼ãƒˆ -</div>
  </div>

  <!-- èƒŒæ™¯ -->
  <div id="bg"></div>

  <!-- CGã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="cg-overlay"></div>

  <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
  <div id="character" style="display:none;">
    <div class="char-body">
      <div class="char-hair"></div>
      <div class="char-hair-side-l"></div>
      <div class="char-hair-side-r"></div>
      <div class="char-face">
        <div class="char-eye left"><div class="char-eye-light"></div></div>
        <div class="char-eye right"><div class="char-eye-light"></div></div>
        <div class="char-blush left"></div>
        <div class="char-blush right"></div>
        <div class="char-mouth"><div class="mouth-normal"></div></div>
      </div>
      <div class="char-collar"></div>
      <div class="char-ribbon"></div>
      <div class="char-uniform"></div>
      <div class="char-skirt"></div>
    </div>
  </div>

  <!-- ãƒãƒ§ã‚³æ¼”å‡º -->
  <div id="chocolate-gift">ğŸ«</div>

  <!-- å¥½æ„Ÿåº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ -->
  <div id="affection-meter">
    <span class="heart-icon">&#9829;</span>
    <div id="affection-bar">
      <div id="affection-fill"></div>
    </div>
  </div>

  <!-- ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
  <div id="textbox" style="display:none;">
    <div id="speaker"></div>
    <div id="dialogue"></div>
    <div id="click-indicator">&#9660;</div>
  </div>

  <!-- é¸æŠè‚¢ -->
  <div id="choices"></div>

  <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
  <div id="ending-screen"></div>
</div>

<script>
// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
const state = {
  affection: 30,
  phase: 'title',
  scriptIndex: 0,
  typing: false,
  typeTimeout: null,
  currentText: '',
  chocoType: '',
};

// DOMè¦ç´ 
const $ = id => document.getElementById(id);
const bg = $('bg');
const character = $('character');
const textbox = $('textbox');
const speaker = $('speaker');
const dialogue = $('dialogue');
const choices = $('choices');
const transition = $('transition');
const chocoGift = $('chocolate-gift');
const affectionMeter = $('affection-meter');
const affectionFill = $('affection-fill');
const titleScreen = $('title-screen');
const endingScreen = $('ending-screen');
const cgOverlay = $('cg-overlay');

// ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®ãƒãƒ¼ãƒˆ
function createTitleHearts() {
  for (let i = 0; i < 15; i++) {
    const heart = document.createElement('div');
    heart.className = 'title-heart';
    heart.textContent = 'â™¥';
    heart.style.left = Math.random() * 100 + '%';
    heart.style.fontSize = (14 + Math.random() * 20) + 'px';
    heart.style.animationDuration = (6 + Math.random() * 8) + 's';
    heart.style.animationDelay = Math.random() * 8 + 's';
    titleScreen.appendChild(heart);
  }
}
createTitleHearts();

// å¥½æ„Ÿåº¦æ›´æ–°
function updateAffection(val) {
  state.affection = Math.max(0, Math.min(100, state.affection + val));
  affectionFill.style.width = state.affection + '%';
}

// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨æƒ…
function setExpression(expr) {
  const mouth = document.querySelector('.char-mouth');
  const blushL = document.querySelector('.char-blush.left');
  const blushR = document.querySelector('.char-blush.right');

  switch(expr) {
    case 'normal':
      mouth.innerHTML = '<div class="mouth-normal"></div>';
      blushL.classList.remove('visible');
      blushR.classList.remove('visible');
      break;
    case 'smile':
      mouth.innerHTML = '<div class="mouth-smile"></div>';
      blushL.classList.remove('visible');
      blushR.classList.remove('visible');
      break;
    case 'blush':
      mouth.innerHTML = '<div class="mouth-smile"></div>';
      blushL.classList.add('visible');
      blushR.classList.add('visible');
      break;
    case 'surprise':
      mouth.innerHTML = '<div class="mouth-surprise"></div>';
      blushL.classList.remove('visible');
      blushR.classList.remove('visible');
      break;
    case 'shy':
      mouth.innerHTML = '<div class="mouth-normal"></div>';
      blushL.classList.add('visible');
      blushR.classList.add('visible');
      break;
    case 'happy':
      mouth.innerHTML = '<div class="mouth-smile"></div>';
      blushL.classList.add('visible');
      blushR.classList.add('visible');
      break;
  }
}

// èƒŒæ™¯åˆ‡ã‚Šæ›¿ãˆ
function setBg(name) {
  bg.className = 'bg-' + name;
  bg.innerHTML = '';

  if (name === 'classroom') {
    for (let i = 0; i < 3; i++) {
      const w = document.createElement('div');
      w.className = 'bg-detail window-frame';
      bg.appendChild(w);
    }
  }
  if (name === 'rooftop') {
    const f = document.createElement('div');
    f.className = 'bg-detail fence';
    bg.appendChild(f);
  }
}

// ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼ï¼‰
function typeText(name, text) {
  return new Promise(resolve => {
    speaker.textContent = name;
    dialogue.textContent = '';
    state.typing = true;
    state.currentText = text;
    let i = 0;

    function typeNext() {
      if (i < text.length) {
        dialogue.textContent += text[i];
        i++;
        state.typeTimeout = setTimeout(typeNext, 35);
      } else {
        state.typing = false;
        resolve();
      }
    }
    typeNext();
  });
}

// ã‚¿ã‚¤ãƒ—ã‚¹ã‚­ãƒƒãƒ—
function skipType() {
  if (state.typing) {
    clearTimeout(state.typeTimeout);
    dialogue.textContent = state.currentText;
    state.typing = false;
    return true;
  }
  return false;
}

// é¸æŠè‚¢è¡¨ç¤º
function showChoices(choiceList) {
  return new Promise(resolve => {
    choices.innerHTML = '';
    choices.style.display = 'flex';
    $('click-indicator').style.display = 'none';

    choiceList.forEach((c, i) => {
      const btn = document.createElement('button');
      btn.className = 'choice-btn';
      btn.textContent = c.text;
      btn.addEventListener('click', () => {
        choices.style.display = 'none';
        $('click-indicator').style.display = '';
        resolve(c);
      });
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶
      btn.style.opacity = '0';
      btn.style.transform = 'translateX(-20px)';
      btn.style.transition = 'all 0.4s ease';
      setTimeout(() => {
        btn.style.opacity = '1';
        btn.style.transform = 'translateX(0)';
      }, 100 + i * 120);
      choices.appendChild(btn);
    });
  });
}

// ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
function fadeOut() {
  return new Promise(r => {
    transition.classList.add('active');
    setTimeout(r, 700);
  });
}
function fadeIn() {
  return new Promise(r => {
    transition.classList.remove('active');
    setTimeout(r, 700);
  });
}

// ãƒãƒ§ã‚³æ¼”å‡º
function showChocolate() {
  return new Promise(r => {
    chocoGift.classList.add('show');
    setTimeout(() => {
      chocoGift.classList.remove('show');
      r();
    }, 1800);
  });
}

// ãƒãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
function spawnHearts(count = 8) {
  for (let i = 0; i < count; i++) {
    const h = document.createElement('div');
    h.className = 'heart-particle';
    h.textContent = 'â™¥';
    h.style.left = (30 + Math.random() * 40) + '%';
    h.style.top = (40 + Math.random() * 20) + '%';
    h.style.animationDelay = (Math.random() * 1) + 's';
    h.style.fontSize = (12 + Math.random() * 16) + 'px';
    document.getElementById('game').appendChild(h);
    setTimeout(() => h.remove(), 4500);
  }
}

// æ¡œã®èŠ±ã³ã‚‰
function spawnSakura() {
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'sakura-petal';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (4 + Math.random() * 4) + 's';
    p.style.animationDelay = Math.random() * 5 + 's';
    document.getElementById('game').appendChild(p);
    setTimeout(() => p.remove(), 10000);
  }
}

// ã‚¯ãƒªãƒƒã‚¯å¾…ã¡
function waitClick() {
  return new Promise(resolve => {
    function handler() {
      if (!skipType()) {
        document.removeEventListener('click', handler);
        resolve();
      }
    }
    document.addEventListener('click', handler);
  });
}

// ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
function showEnding(type, title, text, color) {
  endingScreen.className = 'ending-' + type;
  endingScreen.style.display = 'flex';
  endingScreen.innerHTML = `
    <div class="ending-label" style="color:${color}; opacity:0.6;">â€” ${type.toUpperCase()} END â€”</div>
    <h2 style="color:${color};">${title}</h2>
    <div class="ending-text">${text}</div>
    <button class="retry-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦æœ€åˆã‹ã‚‰</button>
  `;
  textbox.style.display = 'none';
  character.style.display = 'none';

  if (type === 'good') {
    spawnHearts(20);
    setInterval(() => spawnHearts(5), 2000);
    spawnSakura();
  }
}

// ===== ãƒ¡ã‚¤ãƒ³ã‚·ãƒŠãƒªã‚ª =====
async function startGame() {
  // ã‚¿ã‚¤ãƒˆãƒ« â†’ ã‚²ãƒ¼ãƒ 
  await fadeOut();
  titleScreen.style.display = 'none';
  setBg('kitchen');
  textbox.style.display = '';
  await fadeIn();

  // ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°
  await typeText('', '2æœˆ13æ—¥ â”€â”€ ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã®å‰æ—¥ã€‚'); await waitClick();
  await typeText('', 'ç§ã¯ã‚­ãƒƒãƒãƒ³ã«ç«‹ã£ã¦ã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚’ä½œã£ã¦ã„ãŸã€‚'); await waitClick();
  await typeText('', 'æ˜æ—¥ã€ã‚ã®äººã«æ¸¡ã™ãŸã‚ã«â”€â”€'); await waitClick();

  // é¸æŠ1: ãƒãƒ§ã‚³ã®ç¨®é¡
  await typeText('', 'ã•ã¦ã€ã©ã‚“ãªãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚’ä½œã‚ã†â€¦â€¦ï¼Ÿ');
  const choco = await showChoices([
    { text: 'ç”Ÿãƒãƒ§ã‚³ãƒˆãƒªãƒ¥ãƒ• â”€â”€ æœ¬å‘½æ„Ÿã®ã‚ã‚‹ã€ã¨ã£ã¦ãŠãã®ä¸€å“', value: 'truffle', aff: 10 },
    { text: 'ãƒ•ã‚©ãƒ³ãƒ€ãƒ³ã‚·ãƒ§ã‚³ãƒ© â”€â”€ æ‰‹ã®è¾¼ã‚“ã ã€æ¸©ã‹ã„ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', value: 'fondant', aff: 15 },
    { text: 'æ¿ãƒãƒ§ã‚³ã«ãƒªãƒœãƒ³ â”€â”€ ã‚·ãƒ³ãƒ—ãƒ«ã ã‘ã©ã€æ°—æŒã¡ã‚’è¾¼ã‚ã¦', value: 'simple', aff: 0 },
  ]);
  state.chocoType = choco.value;
  updateAffection(choco.aff);

  if (choco.value === 'truffle') {
    await typeText('', 'ä¸å¯§ã«ã‚¬ãƒŠãƒƒã‚·ãƒ¥ã‚’ç·´ã‚Šã€ã²ã¨ã¤ã²ã¨ã¤ä¸¸ã‚ã¦ã„ãã€‚'); await waitClick();
    await typeText('', 'ã‚³ã‚³ã‚¢ãƒ‘ã‚¦ãƒ€ãƒ¼ã‚’ã¾ã¶ã—ã¦â€¦â€¦ã†ã‚“ã€ä¸Šæ‰‹ã«ã§ããŸã€‚'); await waitClick();
  } else if (choco.value === 'fondant') {
    await typeText('', 'ä½•åº¦ã‚‚è©¦ä½œã—ãŸç”²æ–ãŒã‚ã£ã¦ã€ã¨ã‚ã‚Šã¨ã—ãŸä»•ä¸ŠãŒã‚Šã€‚'); await waitClick();
    await typeText('', 'ç„¼ãä¸ŠãŒã‚Šã‚’ç¢ºèªã—ã¦â”€â”€å®Œç’§ã€‚ã“ã‚Œãªã‚‰ã€ãã£ã¨ã€‚'); await waitClick();
  } else {
    await typeText('', 'å¸‚è²©ã®æ¿ãƒãƒ§ã‚³ã«ã€å¿ƒã‚’è¾¼ã‚ã¦ãƒªãƒœãƒ³ã‚’çµã‚“ã ã€‚'); await waitClick();
    await typeText('', 'å¤§äº‹ãªã®ã¯æ°—æŒã¡â€¦â€¦ã ã‚ˆã­ï¼Ÿ'); await waitClick();
  }

  await typeText('', 'å°ã•ãªç®±ã«è©°ã‚ã¦ã€ãƒªãƒœãƒ³ã‚’ã‹ã‘ã‚‹ã€‚'); await waitClick();
  await typeText('', 'â€¦â€¦ã‚ˆã—ã€‚ã‚ã¨ã¯ã€æ˜æ—¥ã®å‹‡æ°—ã ã‘ã€‚'); await waitClick();

  // å ´é¢è»¢æ›ï¼š2æœˆ14æ—¥ æœ
  await fadeOut();
  setBg('classroom');
  affectionMeter.style.display = 'flex';
  await fadeIn();

  await typeText('', 'â”€â”€ 2æœˆ14æ—¥ã€‚ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ‡ãƒ¼å½“æ—¥ã€‚'); await waitClick();
  await typeText('', 'æ•™å®¤ã«å…¥ã‚‹ã¨ã€ã„ã¤ã‚‚ã‚ˆã‚Šã©ã“ã‹æµ®ãè¶³ç«‹ã£ãŸç©ºæ°—ã€‚'); await waitClick();
  await typeText('', 'å¥³ã®å­ãŸã¡ãŒãã‚ãã‚ã¨å°ã•ãªç´™è¢‹ã‚’æŠ±ãˆã¦ã„ã‚‹ã€‚'); await waitClick();
  await typeText('', 'â€¦â€¦ç§ã®ã‚«ãƒãƒ³ã®ä¸­ã«ã‚‚ã€æ˜¨æ—¥ä½œã£ãŸãƒãƒ§ã‚³ãŒå…¥ã£ã¦ã„ã‚‹ã€‚'); await waitClick();

  // ã‚­ãƒ£ãƒ©ç™»å ´
  character.style.display = '';
  character.style.opacity = '0';
  setTimeout(() => character.style.opacity = '1', 50);
  setExpression('normal');

  await typeText('ç›¸æ²¢ æ‚ ', 'ãŠã¯ã‚ˆã†ã€‚ä»Šæ—¥ã¯ãªã‚“ã‹æ•™å®¤ã–ã‚ã¤ã„ã¦ã‚‹ãªã€‚'); await waitClick();
  await typeText('', 'ç›¸æ²¢ãã‚“ãŒã„ã¤ã‚‚ã®å¸­ã«åº§ã£ãŸã€‚'); await waitClick();
  await typeText('', 'éš£ã®å¸­â”€â”€ã¤ã¾ã‚Šã€ç§ã®ã™ãæ¨ªã«ã€‚'); await waitClick();

  setExpression('smile');
  await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚“ï¼Ÿ ã©ã†ã‹ã—ãŸï¼Ÿ é¡”èµ¤ã„ã‘ã©ã€‚'); await waitClick();

  // é¸æŠ2: æœã®å¯¾å¿œ
  await typeText('', 'ï¼ˆã©ã€ã©ã†ã—ã‚ˆã†â€¦â€¦ï¼‰');
  const morning = await showChoices([
    { text: 'ã€Œãªã€ãªã‚“ã§ã‚‚ãªã„ï¼ ä»Šæ—¥å¯’ã„ã‹ã‚‰ã‹ãªã€', value: 'deny', aff: 0 },
    { text: 'ã€Œâ€¦â€¦ã‚ã¨ã§ã€ã¡ã‚‡ã£ã¨è©±ãŒã‚ã‚‹ã‚“ã ã‘ã©ã€', value: 'hint', aff: 10 },
    { text: 'ï¼ˆç›®ã‚’ãã‚‰ã—ã¦é»™ã‚‹ï¼‰', value: 'silent', aff: -5 },
  ]);
  updateAffection(morning.aff);

  if (morning.value === 'deny') {
    setExpression('normal');
    await typeText('ç›¸æ²¢ æ‚ ', 'ãã†ã‹ï¼Ÿ ãŸã—ã‹ã«ä»Šæœã¯å†·ãˆãŸã‚‚ã‚“ãªã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ã¯ç‰¹ã«æ°—ã«ã—ãŸæ§˜å­ã‚‚ãªãã€æ•™ç§‘æ›¸ã‚’é–‹ã„ãŸã€‚'); await waitClick();
  } else if (morning.value === 'hint') {
    setExpression('surprise');
    await typeText('ç›¸æ²¢ æ‚ ', 'è©±ï¼Ÿ â€¦â€¦ã‚ã‹ã£ãŸã€‚æ˜¼ä¼‘ã¿ã«ã§ã‚‚ã€‚'); await waitClick();
    setExpression('smile');
    await typeText('', 'å°‘ã—ã ã‘ä¸æ€è­°ãã†ãªé¡”ã‚’ã—ãŸã‚ã¨ã€å„ªã—ãå¾®ç¬‘ã‚“ã ã€‚'); await waitClick();
    spawnHearts(3);
  } else {
    setExpression('normal');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦â€¦â€¦ï¼Ÿ ã¾ã‚ã€ã„ã„ã‘ã©ã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ã¯å°‘ã—å›°ã£ãŸã‚ˆã†ãªé¡”ã‚’ã—ã¦ã€å‰ã‚’å‘ã„ãŸã€‚'); await waitClick();
  }

  await typeText('', 'â”€â”€ åˆå‰ã®æˆæ¥­ãŒã€ã„ã¤ã‚‚ã‚ˆã‚Šé•·ãæ„Ÿã˜ãŸã€‚'); await waitClick();

  // å ´é¢è»¢æ›ï¼šæ˜¼ä¼‘ã¿
  await fadeOut();
  setBg('hallway');
  character.style.display = 'none';
  await fadeIn();

  await typeText('', 'æ˜¼ä¼‘ã¿ã€‚å»Šä¸‹ã¯ç”Ÿå¾’ãŸã¡ã§è³‘ã‚ã£ã¦ã„ã‚‹ã€‚'); await waitClick();
  await typeText('', 'ã‚ã¡ã“ã¡ã§ã€å¥³ã®å­ãŒãƒãƒ§ã‚³ã‚’æ¸¡ã—ã¦ã„ã‚‹å§¿ãŒè¦‹ãˆã‚‹ã€‚'); await waitClick();
  await typeText('', 'ç§ã¯ã‚«ãƒãƒ³ã‹ã‚‰ãã£ã¨å°ã•ãªç®±ã‚’å–ã‚Šå‡ºã—ãŸã€‚'); await waitClick();
  await typeText('', 'å¿ƒè‡“ãŒã€ã†ã‚‹ã•ã„ãã‚‰ã„ã«é³´ã£ã¦ã„ã‚‹ã€‚'); await waitClick();

  // é¸æŠ3: æ¸¡ã™å ´æ‰€
  await typeText('', 'ã©ã“ã§æ¸¡ãã†â€¦â€¦');
  const place = await showChoices([
    { text: 'å±‹ä¸Šã«å‘¼ã³å‡ºã™ â”€â”€ äºŒäººãã‚Šã§ã€ã¡ã‚ƒã‚“ã¨ä¼ãˆãŸã„', value: 'rooftop', aff: 15 },
    { text: 'å»Šä¸‹ã§æ¸¡ã™ â”€â”€ ã“ã®ã¾ã¾ã€å‹¢ã„ã§', value: 'hallway', aff: 5 },
    { text: 'æ•™å®¤ã§æ¸¡ã™ â”€â”€ ã¿ã‚“ãªã®å‰ã§ã€å ‚ã€…ã¨', value: 'classroom', aff: 0 },
  ]);
  updateAffection(place.aff);

  await fadeOut();
  if (place.value === 'rooftop') {
    setBg('rooftop');
  } else if (place.value === 'classroom') {
    setBg('classroom');
  }
  character.style.display = '';
  setExpression('normal');
  await fadeIn();

  if (place.value === 'rooftop') {
    await typeText('', 'ã€Œå±‹ä¸Šã§å¾…ã£ã¦ã‚‹ã€ã¨çŸ­ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ãŸã€‚'); await waitClick();
    await typeText('', 'é¢¨ãŒé«ªã‚’æºã‚‰ã™ã€‚ç©ºãŒåºƒã„ã€‚'); await waitClick();
    await typeText('', 'â”€â”€ å°‘ã—ã—ã¦ã€æ‰‰ãŒé–‹ãéŸ³ãŒã—ãŸã€‚'); await waitClick();
    setExpression('surprise');
    await typeText('ç›¸æ²¢ æ‚ ', 'ã‚ã–ã‚ã–å±‹ä¸Šã£ã¦â€¦â€¦ã©ã†ã—ãŸã‚“ã ï¼Ÿ'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ãŒå°‘ã—æ¯ã‚’åˆ‡ã‚‰ã—ã¦ç«‹ã£ã¦ã„ã‚‹ã€‚'); await waitClick();
    await typeText('', 'â€¦â€¦èµ°ã£ã¦ãã¦ãã‚ŒãŸã‚“ã ã€‚'); await waitClick();
  } else if (place.value === 'hallway') {
    await typeText('', 'ç›¸æ²¢ãã‚“ãŒæ•™å®¤ã‹ã‚‰å‡ºã¦ããŸã¨ã“ã‚ã‚’è¦‹ã¤ã‘ãŸã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ãŠã€ã©ã†ã—ãŸï¼Ÿ'); await waitClick();
    await typeText('', 'å‘¨ã‚Šã«ã¯ä½•äººã‹ç”Ÿå¾’ãŒé€šã‚Šéãã¦ã„ãã€‚'); await waitClick();
  } else {
    await typeText('', 'æ•™å®¤ã«æˆ»ã‚‹ã¨ã€ç›¸æ²¢ãã‚“ã¯æœºã§æœ¬ã‚’èª­ã‚“ã§ã„ãŸã€‚'); await waitClick();
    await typeText('', 'ä½•äººã‹ã®ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã®è¦–ç·šã‚’æ„Ÿã˜ã‚‹ã€‚'); await waitClick();
    setExpression('normal');
    await typeText('ç›¸æ²¢ æ‚ ', 'ã‚“ã€ã©ã†ã—ãŸï¼Ÿ'); await waitClick();
  }

  // é¸æŠ4: æ¸¡ã—æ–¹
  await typeText('', 'â”€â”€ ä»Šã ã€‚ä»Šã—ã‹ãªã„ã€‚');
  const give = await showChoices([
    { text: 'ã€Œã“ã‚Œâ€¦â€¦ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã€ã ã‹ã‚‰ã€ã¾ã£ã™ãç›®ã‚’è¦‹ã¦æ¸¡ã™', value: 'direct', aff: 20 },
    { text: 'ã€Œã‚ã®ã€ãˆã£ã¨â€¦â€¦ã“ã‚Œã€ã‚ˆã‹ã£ãŸã‚‰ã€å°‘ã—ã†ã¤ã‚€ã„ã¦å·®ã—å‡ºã™', value: 'shy', aff: 10 },
    { text: 'ã€Œç¾©ç†ã¨ã‹ã˜ã‚ƒãªãã¦â€¦â€¦æœ¬å‘½ã€ã§ã™ã€è¨€è‘‰ã«ã—ã¦ä¼ãˆã‚‹', value: 'confess', aff: 25 },
  ]);
  updateAffection(give.aff);

  // ãƒãƒ§ã‚³æ¼”å‡º
  await showChocolate();

  if (give.value === 'direct') {
    setExpression('surprise');
    await typeText('ç›¸æ²¢ æ‚ ', 'â”€â”€ãˆã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ã¯ä¸€ç¬å›ºã¾ã£ãŸã€‚'); await waitClick();
    setExpression('blush');
    await typeText('', 'ãã—ã¦ã€ã‚†ã£ãã‚Šã¨ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚’å—ã‘å–ã£ãŸã€‚'); await waitClick();
    spawnHearts(5);
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‚ŠãŒã¨ã†ã€‚ã™ã”ã„ã€å¬‰ã—ã„ã€‚'); await waitClick();
  } else if (give.value === 'shy') {
    setExpression('smile');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ä¿ºã«ï¼Ÿ'); await waitClick();
    await typeText('', 'å°‘ã—é©šã„ãŸã‚ˆã†ã ã£ãŸã‘ã©ã€ã™ãã«å„ªã—ã„é¡”ã«ãªã£ãŸã€‚'); await waitClick();
    setExpression('blush');
    await typeText('ç›¸æ²¢ æ‚ ', 'ã‚ã‚ŠãŒã¨ã†ã€‚å¤§äº‹ã«ã™ã‚‹ã€‚'); await waitClick();
    spawnHearts(3);
  } else {
    setExpression('surprise');
    await typeText('', 'ç©ºæ°—ãŒã€æ­¢ã¾ã£ãŸæ°—ãŒã—ãŸã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦â€¦â€¦ã€‚'); await waitClick();
    setExpression('happy');
    spawnHearts(10);
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦æœ¬å‘½ã€ã‹ã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ã®è€³ãŒèµ¤ããªã£ã¦ã„ã‚‹ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'æ­£ç›´ã«è¨€ã£ã¦ãã‚Œã¦â”€â”€ã‚ã‚ŠãŒã¨ã†ã€‚'); await waitClick();
  }

  // æœ€çµ‚åˆ†å²
  await typeText('', 'â€¦â€¦â€¦â€¦ã€‚'); await waitClick();

  if (state.affection >= 70) {
    // ã‚°ãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰
    setExpression('happy');
    spawnHearts(15);
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ãšã£ã¨ã€è¨€ãŠã†ã¨æ€ã£ã¦ãŸã‚“ã ã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ãŒä¸€æ­©ã€è¿‘ã¥ã„ã¦ãã‚‹ã€‚'); await waitClick();

    if (place.value === 'rooftop') {
      // CG: å¤•ç„¼ã‘
      cgOverlay.className = 'cg-sunset';
      cgOverlay.style.display = 'flex';
      cgOverlay.style.opacity = '0';
      cgOverlay.style.transition = 'opacity 1.5s ease';
      setTimeout(() => cgOverlay.style.opacity = '0.4', 50);
      spawnSakura();
    }

    await typeText('ç›¸æ²¢ æ‚ ', 'ä¿ºã‚‚ã€ãŠå‰ã®ã“ã¨â”€â”€å¥½ãã ã£ãŸã€‚'); await waitClick();
    spawnHearts(20);
    await typeText('', 'é¢¨ãŒå„ªã—ãå¹ã„ãŸã€‚'); await waitClick();
    await typeText('', 'æ¶™ãŒã«ã˜ã‚“ã§ã€ã§ã‚‚ã€ç¬‘ã£ã¦ã„ãŸã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã€çµ¶å¯¾è¿”ã™ã‹ã‚‰ã€‚â€¦â€¦å¾…ã£ã¦ã¦ãã‚Œã€‚'); await waitClick();
    setExpression('happy');
    await typeText('', 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã®ç®±ã‚’ã€å¤§äº‹ãã†ã«èƒ¸ã«æŠ±ãç›¸æ²¢ãã‚“ã€‚'); await waitClick();
    await typeText('', 'â”€â”€ ã“ã‚ŒãŒã€ç§ãŸã¡ã®å§‹ã¾ã‚Šã®æ—¥ã«ãªã£ãŸã€‚'); await waitClick();

    await fadeOut();
    showEnding('good', 'ä¸¡æƒ³ã„ã®ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ',
      'ã‚ãªãŸã®æ°—æŒã¡ã¯ã€ã¾ã£ã™ãã«å±Šãã¾ã—ãŸã€‚<br><br>ç”˜ãã¦æ¸©ã‹ã„ã€äºŒäººã ã‘ã®ç‰¹åˆ¥ãªãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã€‚<br><br>ã“ã‚Œã‹ã‚‰ã‚‚ã€ã“ã®æ¸©ã‚‚ã‚ŠãŒç¶šã„ã¦ã„ãã¾ã™ã‚ˆã†ã«â”€â”€',
      '#FF69B4');

  } else if (state.affection >= 40) {
    // ãƒãƒ¼ãƒãƒ«ã‚¨ãƒ³ãƒ‰
    setExpression('smile');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦æ‰‹ä½œã‚Šã€ãªã‚“ã ãªã€‚ã‚ã‚ŠãŒã¨ã†ã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ã¯å¬‰ã—ãã†ã ã£ãŸã‘ã©ã€'); await waitClick();
    await typeText('', 'ã©ã“ã‹å›°ã£ãŸã‚ˆã†ãªè¡¨æƒ…ã‚‚æ··ã˜ã£ã¦ã„ãŸã€‚'); await waitClick();
    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'æ­£ç›´ã€ã¾ã æ°—æŒã¡ã®æ•´ç†ãŒã¤ã‹ãªã„ã‚“ã ã‘ã©â€¦â€¦'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ã¡ã‚ƒã‚“ã¨è€ƒãˆã¦ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã«ç­”ãˆã‚’å‡ºã™ã‚ˆã€‚'); await waitClick();
    await typeText('', 'â€¦â€¦ã¾ã ã‚ã‹ã‚‰ãªã„ã€‚ã§ã‚‚ã€ä¼ãˆã‚‰ã‚ŒãŸã€‚'); await waitClick();
    await typeText('', 'ãã‚Œã ã‘ã§ä»Šã¯ã€ååˆ†ã ã¨æ€ãˆãŸã€‚'); await waitClick();

    await fadeOut();
    showEnding('normal', 'å±Šã„ãŸæƒ³ã„ã€è¿”äº‹ã¯ã¾ã ',
      'ã‚ãªãŸã®æ°—æŒã¡ã¯ã€ã¡ã‚ƒã‚“ã¨å±Šãã¾ã—ãŸã€‚<br><br>ç­”ãˆã¯ã¾ã å…ˆã€‚ã§ã‚‚ã€ä¸€æ­©è¸ã¿å‡ºã›ãŸã“ã¨ã«å¤‰ã‚ã‚Šã¯ãªã„ã€‚<br><br>3æœˆ14æ—¥ãŒã€å°‘ã—ã ã‘æ¥½ã—ã¿ã§ã™â”€â”€',
      '#B0C4DE');

  } else {
    // ãƒãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰
    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‚ŠãŒã¨ã†ã€‚'); await waitClick();
    await typeText('', 'ãã‚Œã ã‘è¨€ã£ã¦ã€ç›¸æ²¢ãã‚“ã¯å°‘ã—æ°—ã¾ãšãã†ã«ç¬‘ã£ãŸã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ã”ã‚ã‚“ã€‚æ°—æŒã¡ã¯å¬‰ã—ã„ã‚“ã ã‘ã©â€¦â€¦'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'å‹é”ã¨ã—ã¦ã€ã“ã‚Œã‹ã‚‰ã‚‚ã‚ˆã‚ã—ãã€‚'); await waitClick();
    await typeText('', 'â€¦â€¦ã‚ã‹ã£ã¦ãŸã€‚ã‚ã‹ã£ã¦ãŸã‘ã©ã€‚'); await waitClick();
    await typeText('', 'å¸°ã‚Šé“ã€ãƒãƒ§ã‚³ã®æ®‹ã‚Šé¦™ã ã‘ãŒæ‰‹ã«æ®‹ã£ã¦ã„ãŸã€‚'); await waitClick();

    await fadeOut();
    showEnding('bad', 'ã»ã‚è‹¦ã„æ”¾èª²å¾Œ',
      'æƒ³ã„ã¯å±Šã„ãŸã‘ã‚Œã©ã€ç­”ãˆã¯æœ›ã‚“ã ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br><br>ã§ã‚‚ã€ä¼ãˆãªã‹ã£ãŸå¾Œæ‚”ã‚ˆã‚Šã‚‚ã€<br>ä¼ãˆãŸä»Šã®æ–¹ãŒãšã£ã¨ã„ã„ã€‚<br><br>â€¦â€¦ã„ã¤ã‹ç¬‘ã£ã¦æ€ã„å‡ºã›ã‚‹æ—¥ãŒæ¥ã‚‹ã¯ãšã€‚',
      '#8888AA');
  }
}

// ã‚¿ã‚¤ãƒˆãƒ«ã‚¯ãƒªãƒƒã‚¯
titleScreen.addEventListener('click', () => {
  if (state.phase === 'title') {
    state.phase = 'game';
    startGame();
  }
});
</script>
</body>
</html>
