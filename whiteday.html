<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ ~ã‚ã®æ—¥ã®ç­”ãˆ~</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Zen+Old+Mincho&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0a0e1e;
  overflow: hidden;
  font-family: 'Zen Maru Gothic', sans-serif;
  user-select: none;
}

#game {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
}

/* === èƒŒæ™¯ === */
#bg {
  position: absolute;
  inset: 0;
  transition: opacity 0.8s ease;
}

.bg-classroom-morning {
  background: linear-gradient(180deg, #B4D7FF 0%, #D6EBFF 25%, #FFF8DC 30%, #FFFDE8 100%);
}

.bg-hallway-afternoon {
  background: linear-gradient(180deg, #E8D5B7 0%, #F5E6D0 20%, #DEB887 40%, #D2B48C 100%);
}

.bg-rooftop-sunset {
  background: linear-gradient(180deg, #FF7E5F 0%, #FEB47B 20%, #FFD4A2 40%, #FFF0D0 55%, #D0D0D0 55%, #B8B8B8 100%);
}

.bg-park-evening {
  background: linear-gradient(180deg, #2C1654 0%, #4A2080 15%, #FF6B8A 35%, #FFB88C 50%, #4CAF50 65%, #2E7D32 100%);
}

.bg-cafe {
  background: linear-gradient(180deg, #FFF3E0 0%, #FFE0B2 20%, #8D6E63 60%, #5D4037 80%, #3E2723 100%);
}

.bg-street-night {
  background: linear-gradient(180deg, #0D1B2A 0%, #1B2838 20%, #2C3E50 40%, #34495E 60%, #2C3E50 80%, #1a1a2e 100%);
}

.bg-aquarium {
  background: linear-gradient(180deg, #001833 0%, #003366 20%, #004C99 40%, #0066CC 60%, #004C99 80%, #001833 100%);
}

/* èƒŒæ™¯è£…é£¾ */
.bg-detail {
  position: absolute;
  pointer-events: none;
}

/* æ•™å®¤ã®çª“ */
.window-frame {
  width: 120px; height: 150px;
  border: 6px solid #8B7355;
  background: rgba(180,215,255,0.3);
  top: 5%;
}
.window-frame:nth-child(1) { left: 10%; }
.window-frame:nth-child(2) { left: 35%; }
.window-frame:nth-child(3) { left: 60%; }

/* å±‹ä¸Šã®ãƒ•ã‚§ãƒ³ã‚¹ */
.fence {
  width: 100%; height: 3px;
  background: repeating-linear-gradient(90deg, #999 0px, #999 2px, transparent 2px, transparent 15px);
  top: 53%;
}

/* å¤œã®æ˜Ÿ */
.star {
  position: absolute;
  width: 2px; height: 2px;
  background: white;
  border-radius: 50%;
  animation: twinkle 2s ease-in-out infinite alternate;
}
@keyframes twinkle {
  0% { opacity: 0.3; }
  100% { opacity: 1; }
}

/* æ°´æ—é¤¨ã®æ³¡ */
.bubble {
  position: absolute;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent);
  animation: bubbleRise linear infinite;
}
@keyframes bubbleRise {
  0% { transform: translateY(0) translateX(0); opacity: 0; }
  10% { opacity: 0.6; }
  90% { opacity: 0.6; }
  100% { transform: translateY(-100vh) translateX(30px); opacity: 0; }
}

/* é­š */
.fish {
  position: absolute;
  font-size: 28px;
  animation: fishSwim linear infinite;
  opacity: 0.7;
}
@keyframes fishSwim {
  0% { transform: translateX(-50px) translateY(0); }
  25% { transform: translateX(25vw) translateY(-15px); }
  50% { transform: translateX(50vw) translateY(5px); }
  75% { transform: translateX(75vw) translateY(-10px); }
  100% { transform: translateX(105vw) translateY(0); }
}

/* ã‚«ãƒ•ã‚§ã®å…‰ */
.cafe-light {
  position: absolute;
  width: 200px; height: 200px;
  background: radial-gradient(circle, rgba(255,200,100,0.15) 0%, transparent 70%);
  border-radius: 50%;
}

/* ===  ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« === */
.heart-particle {
  position: absolute;
  color: #FF69B4;
  font-size: 16px;
  pointer-events: none;
  animation: floatHeart 4s ease-in-out infinite;
  opacity: 0.6;
}

@keyframes floatHeart {
  0% { transform: translateY(0) rotate(0deg); opacity: 0; }
  20% { opacity: 0.6; }
  80% { opacity: 0.6; }
  100% { transform: translateY(-200px) rotate(20deg); opacity: 0; }
}

.sakura-petal {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #FFB7C5;
  border-radius: 50% 0 50% 50%;
  opacity: 0.7;
  animation: sakuraFall linear infinite;
}
@keyframes sakuraFall {
  0% { transform: translateY(-20px) rotate(0deg) translateX(0); opacity: 0; }
  10% { opacity: 0.7; }
  90% { opacity: 0.7; }
  100% { transform: translateY(100vh) rotate(720deg) translateX(100px); opacity: 0; }
}

.sparkle {
  position: absolute;
  color: #FFD700;
  font-size: 14px;
  pointer-events: none;
  animation: sparkleAnim 1.5s ease-out forwards;
}
@keyframes sparkleAnim {
  0% { transform: scale(0) rotate(0deg); opacity: 1; }
  50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
  100% { transform: scale(0) rotate(360deg); opacity: 0; }
}

/* === ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆç›¸æ²¢ æ‚ ï¼‰ === */
#character {
  position: absolute;
  bottom: 12%;
  left: 50%;
  transform: translateX(-50%);
  transition: all 0.6s ease;
  z-index: 5;
}

.char-body {
  position: relative;
  width: 180px;
  height: 340px;
}

.char-face {
  width: 88px;
  height: 92px;
  background: #FFE0BD;
  border-radius: 44px 44px 38px 38px;
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}

.char-hair {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 55px;
  background: #1a1a2e;
  border-radius: 50px 50px 8px 8px;
  z-index: 3;
}

.char-hair-front {
  position: absolute;
  top: 15px;
  left: 46px;
  width: 35px;
  height: 30px;
  background: #1a1a2e;
  clip-path: polygon(0% 0%, 100% 0%, 85% 100%, 15% 80%);
  z-index: 5;
}

.char-hair-side-l, .char-hair-side-r {
  position: absolute;
  top: 20px;
  width: 16px;
  height: 50px;
  background: #1a1a2e;
  z-index: 3;
}
.char-hair-side-l { left: 35px; border-radius: 0 0 6px 6px; }
.char-hair-side-r { right: 35px; border-radius: 0 0 6px 6px; }

.char-eye {
  position: absolute;
  width: 12px;
  height: 14px;
  background: #1a1a2e;
  border-radius: 50%;
  top: 36px;
  z-index: 4;
}
.char-eye.left { left: 57px; }
.char-eye.right { right: 57px; }

.char-eye-light {
  position: absolute;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  top: 2px;
  right: 2px;
}

.char-eyebrow {
  position: absolute;
  width: 16px;
  height: 3px;
  background: #1a1a2e;
  border-radius: 2px;
  top: 28px;
  z-index: 4;
}
.char-eyebrow.left { left: 55px; }
.char-eyebrow.right { right: 55px; }

.char-mouth {
  position: absolute;
  top: 58px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 4;
  transition: all 0.3s;
}

.mouth-normal { width: 10px; height: 5px; border-bottom: 2px solid #C4756B; border-radius: 0 0 5px 5px; }
.mouth-smile { width: 16px; height: 9px; border-bottom: 2.5px solid #C4756B; border-radius: 0 0 9px 9px; }
.mouth-grin { width: 20px; height: 12px; border-bottom: 2.5px solid #C4756B; border-radius: 0 0 12px 12px; }
.mouth-surprise { width: 10px; height: 12px; background: #C4756B; border-radius: 50%; }
.mouth-nervous { width: 14px; height: 3px; background: #C4756B; border-radius: 2px; }

.char-blush {
  position: absolute;
  width: 16px;
  height: 9px;
  background: rgba(255,100,100,0.45);
  border-radius: 50%;
  top: 48px;
  z-index: 4;
  opacity: 0;
  transition: opacity 0.5s;
}
.char-blush.left { left: 50px; }
.char-blush.right { right: 50px; }
.char-blush.visible { opacity: 1; }

/* åˆ¶æœï¼ˆç”·å­ï¼‰ */
.char-blazer {
  position: absolute;
  top: 85px;
  left: 50%;
  transform: translateX(-50%);
  width: 110px;
  height: 150px;
  background: #1B3A5C;
  border-radius: 8px 8px 0 0;
  z-index: 1;
}

.char-shirt-collar {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 22px solid transparent;
  border-right: 22px solid transparent;
  border-top: 18px solid white;
  z-index: 2;
}

.char-tie {
  position: absolute;
  top: 88px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 3;
}
.char-tie-knot {
  width: 12px; height: 10px;
  background: #C0392B;
  clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
  margin: 0 auto;
}
.char-tie-body {
  width: 10px; height: 35px;
  background: #C0392B;
  clip-path: polygon(15% 0%, 85% 0%, 65% 100%, 35% 100%);
  margin: 0 auto;
}

.char-pants {
  position: absolute;
  top: 232px;
  left: 50%;
  transform: translateX(-50%);
  width: 105px;
  height: 70px;
  background: #2C3E50;
  border-radius: 0 0 4px 4px;
  z-index: 1;
}

/* ç§æœç”¨ï¼ˆãƒ‡ãƒ¼ãƒˆï¼‰ */
.char-casual-top {
  position: absolute;
  top: 85px;
  left: 50%;
  transform: translateX(-50%);
  width: 108px;
  height: 148px;
  background: linear-gradient(180deg, #F5F5F5 0%, #E8E8E8 100%);
  border-radius: 8px 8px 0 0;
  z-index: 1;
}

.char-casual-collar {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 50px;
  height: 14px;
  background: #F5F5F5;
  border-radius: 0 0 10px 10px;
  z-index: 2;
}

.char-jacket {
  position: absolute;
  top: 82px;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: 155px;
  background: #2C3E50;
  border-radius: 8px 8px 0 0;
  z-index: 0;
  clip-path: polygon(0% 0%, 35% 0%, 35% 100%, 0% 100%, 0% 0%, 65% 0%, 65% 100%, 100% 100%, 100% 0%);
}

.char-casual-pants {
  position: absolute;
  top: 230px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 72px;
  background: #1a1a2e;
  border-radius: 0 0 4px 4px;
  z-index: 1;
}

/* === ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ === */
#textbox {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  background: linear-gradient(180deg, rgba(10,14,30,0.85) 0%, rgba(20,25,50,0.95) 100%);
  border-top: 2px solid rgba(173,216,230,0.4);
  z-index: 20;
  padding: 20px 40px;
  display: flex;
  flex-direction: column;
}

#speaker {
  font-family: 'Zen Old Mincho', serif;
  color: #ADD8E6;
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 8px;
  min-height: 24px;
  text-shadow: 0 0 10px rgba(173,216,230,0.4);
}

#dialogue {
  font-family: 'Zen Maru Gothic', sans-serif;
  color: #E8EAF0;
  font-size: 17px;
  line-height: 1.8;
  flex: 1;
  letter-spacing: 0.5px;
}

#click-indicator {
  position: absolute;
  bottom: 15px;
  right: 30px;
  color: rgba(173,216,230,0.6);
  font-size: 14px;
  animation: blink 1.2s ease-in-out infinite;
}

@keyframes blink {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

/* === é¸æŠè‚¢ === */
#choices {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 30;
  display: none;
  flex-direction: column;
  gap: 16px;
  width: 500px;
  max-width: 90vw;
}

.choice-btn {
  background: linear-gradient(135deg, rgba(15,20,50,0.9) 0%, rgba(30,40,80,0.9) 100%);
  border: 2px solid rgba(173,216,230,0.4);
  color: #D0E8F0;
  padding: 16px 28px;
  font-size: 16px;
  font-family: 'Zen Maru Gothic', sans-serif;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  letter-spacing: 0.5px;
}

.choice-btn:hover {
  background: linear-gradient(135deg, rgba(40,60,120,0.95) 0%, rgba(60,90,160,0.95) 100%);
  border-color: #87CEEB;
  transform: translateX(8px);
  box-shadow: 0 0 20px rgba(135,206,235,0.3);
}

/* === ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ === */
#title-screen {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, #0a0e1e 0%, #141e3c 30%, #1a2850 60%, #0a0e1e 100%);
  z-index: 50;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

#title-screen h1 {
  font-family: 'Zen Old Mincho', serif;
  color: #ADD8E6;
  font-size: 42px;
  text-shadow: 0 0 30px rgba(173,216,230,0.4), 0 0 60px rgba(135,206,235,0.2);
  margin-bottom: 12px;
  letter-spacing: 4px;
}

#title-screen .subtitle {
  font-family: 'Zen Old Mincho', serif;
  color: rgba(173,216,230,0.6);
  font-size: 18px;
  letter-spacing: 6px;
  margin-bottom: 15px;
}

#title-screen .prev-story {
  color: rgba(255,182,193,0.5);
  font-size: 13px;
  letter-spacing: 2px;
  margin-bottom: 50px;
}

#title-screen .start-text {
  color: rgba(200,220,240,0.5);
  font-size: 15px;
  animation: blink 1.5s ease-in-out infinite;
  letter-spacing: 2px;
}

.title-gift {
  font-size: 80px;
  margin-bottom: 30px;
  filter: drop-shadow(0 0 20px rgba(100,149,237,0.4));
}

.title-float {
  position: absolute;
  opacity: 0.1;
  animation: titleFloat linear infinite;
}

@keyframes titleFloat {
  0% { transform: translateY(100vh) rotate(0deg); }
  100% { transform: translateY(-100px) rotate(360deg); }
}

/* === ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚° === */
#ending-screen {
  position: absolute;
  inset: 0;
  z-index: 50;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 40px;
}

.ending-true {
  background: linear-gradient(135deg, #0a0e1e 0%, #1a1040 20%, #2a1555 40%, #1a1040 60%, #0a0e1e 100%);
}

.ending-sweet {
  background: linear-gradient(135deg, #0a0e1e 0%, #1a2040 30%, #1a3050 60%, #0a0e1e 100%);
}

.ending-bittersweet {
  background: linear-gradient(135deg, #0a0a15 0%, #151525 50%, #0a0a15 100%);
}

#ending-screen h2 {
  font-family: 'Zen Old Mincho', serif;
  font-size: 36px;
  margin-bottom: 30px;
  letter-spacing: 3px;
}

#ending-screen .ending-text {
  font-size: 17px;
  line-height: 2.2;
  color: #D0D8E8;
  max-width: 600px;
  margin-bottom: 50px;
}

#ending-screen .ending-label {
  font-family: 'Zen Old Mincho', serif;
  font-size: 14px;
  letter-spacing: 4px;
  margin-bottom: 40px;
}

.retry-btn {
  background: transparent;
  border: 1px solid rgba(173,216,230,0.4);
  color: #ADD8E6;
  padding: 12px 40px;
  font-size: 15px;
  font-family: 'Zen Maru Gothic', sans-serif;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  letter-spacing: 2px;
  margin: 8px;
}

.retry-btn:hover {
  background: rgba(173,216,230,0.1);
  border-color: #87CEEB;
  box-shadow: 0 0 20px rgba(135,206,235,0.2);
}

/* === ã‚®ãƒ•ãƒˆæ¼”å‡º === */
#gift-item {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  z-index: 15;
  font-size: 110px;
  transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  filter: drop-shadow(0 0 25px rgba(100,149,237,0.5));
}

#gift-item.show {
  transform: translate(-50%, -50%) scale(1);
}

/* === ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ === */
#transition {
  position: absolute;
  inset: 0;
  background: black;
  z-index: 40;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease;
}

#transition.active {
  opacity: 1;
  pointer-events: all;
}

/* === å¥½æ„Ÿåº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ === */
#trust-meter {
  position: absolute;
  top: 15px;
  right: 20px;
  z-index: 25;
  display: none;
  align-items: center;
  gap: 8px;
  background: rgba(10,14,30,0.7);
  padding: 8px 16px;
  border-radius: 20px;
  border: 1px solid rgba(173,216,230,0.3);
}

#trust-meter .trust-icon {
  color: #87CEEB;
  font-size: 16px;
}

#trust-bar {
  width: 100px;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
  overflow: hidden;
}

#trust-fill {
  height: 100%;
  width: 40%;
  background: linear-gradient(90deg, #87CEEB, #6495ED);
  border-radius: 4px;
  transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* === CGæ¼”å‡º === */
#cg-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
  display: none;
  align-items: center;
  justify-content: center;
  transition: opacity 1.5s ease;
}

.cg-starlight {
  background: radial-gradient(ellipse at 50% 30%, rgba(100,149,237,0.15) 0%, transparent 60%);
}

.cg-fireworks {
  background: radial-gradient(ellipse at 30% 20%, rgba(255,100,100,0.15) 0%, transparent 30%),
              radial-gradient(ellipse at 70% 25%, rgba(100,200,255,0.15) 0%, transparent 30%),
              radial-gradient(ellipse at 50% 15%, rgba(255,215,0,0.1) 0%, transparent 25%);
}

/* === å›æƒ³ã‚·ãƒ¼ãƒ³ === */
.memory-vignette {
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, transparent 50%, rgba(255,182,193,0.15) 100%);
  z-index: 11;
  pointer-events: none;
  display: none;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 600px) {
  #title-screen h1 { font-size: 28px; }
  .title-gift { font-size: 60px; }
  #textbox { height: 180px; padding: 15px 20px; }
  #dialogue { font-size: 15px; }
  .choice-btn { font-size: 14px; padding: 12px 20px; }
}
</style>
</head>
<body>
<div id="game">
  <div id="transition"></div>

  <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
  <div id="title-screen">
    <div class="title-gift">ğŸ</div>
    <h1>ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h1>
    <div class="subtitle">~ ã‚ã®æ—¥ã®ç­”ãˆ ~</div>
    <div class="prev-story">ã€Œãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€GOOD END å¾Œæ—¥è­š</div>
    <div class="start-text">- ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ¼ãƒˆ -</div>
  </div>

  <div id="bg"></div>
  <div id="cg-overlay"></div>
  <div class="memory-vignette" id="memory-vignette"></div>

  <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
  <div id="character" style="display:none;">
    <div class="char-body" id="char-body">
      <!-- é«ª -->
      <div class="char-hair"></div>
      <div class="char-hair-front"></div>
      <div class="char-hair-side-l"></div>
      <div class="char-hair-side-r"></div>
      <!-- é¡” -->
      <div class="char-face">
        <div class="char-eyebrow left"></div>
        <div class="char-eyebrow right"></div>
        <div class="char-eye left"><div class="char-eye-light"></div></div>
        <div class="char-eye right"><div class="char-eye-light"></div></div>
        <div class="char-blush left"></div>
        <div class="char-blush right"></div>
        <div class="char-mouth"><div class="mouth-normal"></div></div>
      </div>
      <!-- åˆ¶æœ -->
      <div id="outfit-school">
        <div class="char-shirt-collar"></div>
        <div class="char-tie"><div class="char-tie-knot"></div><div class="char-tie-body"></div></div>
        <div class="char-blazer"></div>
        <div class="char-pants"></div>
      </div>
      <!-- ç§æœï¼ˆéè¡¨ç¤ºï¼‰ -->
      <div id="outfit-casual" style="display:none;">
        <div class="char-jacket"></div>
        <div class="char-casual-collar"></div>
        <div class="char-casual-top"></div>
        <div class="char-casual-pants"></div>
      </div>
    </div>
  </div>

  <!-- ã‚®ãƒ•ãƒˆæ¼”å‡º -->
  <div id="gift-item">ğŸ</div>

  <!-- ä¿¡é ¼åº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ -->
  <div id="trust-meter">
    <span class="trust-icon">&#10038;</span>
    <div id="trust-bar">
      <div id="trust-fill"></div>
    </div>
  </div>

  <!-- ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
  <div id="textbox" style="display:none;">
    <div id="speaker"></div>
    <div id="dialogue"></div>
    <div id="click-indicator">&#9660;</div>
  </div>

  <div id="choices"></div>
  <div id="ending-screen"></div>
</div>

<script>
const state = {
  trust: 40,
  phase: 'title',
  typing: false,
  typeTimeout: null,
  currentText: '',
  dateChoice: '',
  giftChoice: '',
};

const $ = id => document.getElementById(id);
const bg = $('bg');
const character = $('character');
const textbox = $('textbox');
const speaker = $('speaker');
const dialogue = $('dialogue');
const choices = $('choices');
const transition = $('transition');
const giftItem = $('gift-item');
const trustMeter = $('trust-meter');
const trustFill = $('trust-fill');
const titleScreen = $('title-screen');
const endingScreen = $('ending-screen');
const cgOverlay = $('cg-overlay');

// ã‚¿ã‚¤ãƒˆãƒ«ã®æµ®éŠè¦ç´ 
(function createTitleFloats() {
  const symbols = ['âœ¦', 'â™¦', 'âœ§', 'â—‡', 'â‹'];
  for (let i = 0; i < 12; i++) {
    const el = document.createElement('div');
    el.className = 'title-float';
    el.textContent = symbols[i % symbols.length];
    el.style.left = Math.random() * 100 + '%';
    el.style.fontSize = (12 + Math.random() * 18) + 'px';
    el.style.color = Math.random() > 0.5 ? '#ADD8E6' : '#FFB6C1';
    el.style.animationDuration = (7 + Math.random() * 8) + 's';
    el.style.animationDelay = Math.random() * 8 + 's';
    titleScreen.appendChild(el);
  }
})();

function updateTrust(val) {
  state.trust = Math.max(0, Math.min(100, state.trust + val));
  trustFill.style.width = state.trust + '%';
}

function setExpression(expr) {
  const mouth = document.querySelector('.char-mouth');
  const blushL = document.querySelector('.char-blush.left');
  const blushR = document.querySelector('.char-blush.right');
  const browL = document.querySelector('.char-eyebrow.left');
  const browR = document.querySelector('.char-eyebrow.right');

  browL.style.transform = '';
  browR.style.transform = '';

  const expressions = {
    normal:   { m: 'normal',   blush: false },
    smile:    { m: 'smile',    blush: false },
    grin:     { m: 'grin',     blush: false },
    blush:    { m: 'smile',    blush: true },
    surprise: { m: 'surprise', blush: false },
    shy:      { m: 'normal',   blush: true },
    happy:    { m: 'grin',     blush: true },
    nervous:  { m: 'nervous',  blush: true, brow: 'worry' },
    serious:  { m: 'normal',   blush: false, brow: 'flat' },
  };

  const e = expressions[expr] || expressions.normal;
  mouth.innerHTML = `<div class="mouth-${e.m}"></div>`;
  blushL.classList.toggle('visible', e.blush);
  blushR.classList.toggle('visible', e.blush);

  if (e.brow === 'worry') {
    browL.style.transform = 'rotate(8deg)';
    browR.style.transform = 'rotate(-8deg)';
  }
}

function setOutfit(type) {
  $('outfit-school').style.display = type === 'school' ? '' : 'none';
  $('outfit-casual').style.display = type === 'casual' ? '' : 'none';
}

function setBg(name) {
  bg.className = 'bg-' + name;
  bg.innerHTML = '';

  if (name === 'classroom-morning') {
    for (let i = 0; i < 3; i++) {
      const w = document.createElement('div');
      w.className = 'bg-detail window-frame';
      bg.appendChild(w);
    }
  }
  if (name === 'rooftop-sunset') {
    const f = document.createElement('div');
    f.className = 'bg-detail fence';
    bg.appendChild(f);
  }
  if (name === 'street-night') {
    for (let i = 0; i < 40; i++) {
      const s = document.createElement('div');
      s.className = 'bg-detail star';
      s.style.left = Math.random() * 100 + '%';
      s.style.top = Math.random() * 35 + '%';
      s.style.animationDelay = Math.random() * 3 + 's';
      s.style.width = s.style.height = (1 + Math.random() * 2) + 'px';
      bg.appendChild(s);
    }
  }
  if (name === 'aquarium') {
    for (let i = 0; i < 12; i++) {
      const b = document.createElement('div');
      b.className = 'bg-detail bubble';
      b.style.left = Math.random() * 100 + '%';
      b.style.bottom = '-20px';
      b.style.width = b.style.height = (5 + Math.random() * 15) + 'px';
      b.style.animationDuration = (5 + Math.random() * 6) + 's';
      b.style.animationDelay = Math.random() * 8 + 's';
      bg.appendChild(b);
    }
    const fishes = ['ğŸ ', 'ğŸŸ', 'ğŸ¡'];
    for (let i = 0; i < 3; i++) {
      const f = document.createElement('div');
      f.className = 'bg-detail fish';
      f.textContent = fishes[i];
      f.style.top = (25 + Math.random() * 40) + '%';
      f.style.animationDuration = (12 + Math.random() * 8) + 's';
      f.style.animationDelay = (i * 4 + Math.random() * 3) + 's';
      bg.appendChild(f);
    }
  }
  if (name === 'cafe') {
    for (let i = 0; i < 3; i++) {
      const l = document.createElement('div');
      l.className = 'bg-detail cafe-light';
      l.style.left = (10 + i * 35) + '%';
      l.style.top = (5 + i * 10) + '%';
      bg.appendChild(l);
    }
  }
}

function typeText(name, text) {
  return new Promise(resolve => {
    speaker.textContent = name;
    dialogue.textContent = '';
    state.typing = true;
    state.currentText = text;
    let i = 0;
    function next() {
      if (i < text.length) {
        dialogue.textContent += text[i]; i++;
        state.typeTimeout = setTimeout(next, 35);
      } else { state.typing = false; resolve(); }
    }
    next();
  });
}

function skipType() {
  if (state.typing) {
    clearTimeout(state.typeTimeout);
    dialogue.textContent = state.currentText;
    state.typing = false;
    return true;
  }
  return false;
}

function showChoices(list) {
  return new Promise(resolve => {
    choices.innerHTML = '';
    choices.style.display = 'flex';
    $('click-indicator').style.display = 'none';
    list.forEach((c, i) => {
      const btn = document.createElement('button');
      btn.className = 'choice-btn';
      btn.textContent = c.text;
      btn.addEventListener('click', () => {
        choices.style.display = 'none';
        $('click-indicator').style.display = '';
        resolve(c);
      });
      btn.style.opacity = '0';
      btn.style.transform = 'translateX(-20px)';
      btn.style.transition = 'all 0.4s ease';
      setTimeout(() => { btn.style.opacity = '1'; btn.style.transform = 'translateX(0)'; }, 100 + i * 120);
      choices.appendChild(btn);
    });
  });
}

function fadeOut() { return new Promise(r => { transition.classList.add('active'); setTimeout(r, 700); }); }
function fadeIn() { return new Promise(r => { transition.classList.remove('active'); setTimeout(r, 700); }); }

function showGift(emoji) {
  return new Promise(r => {
    giftItem.textContent = emoji || 'ğŸ';
    giftItem.classList.add('show');
    setTimeout(() => { giftItem.classList.remove('show'); r(); }, 1800);
  });
}

function spawnHearts(count = 8) {
  for (let i = 0; i < count; i++) {
    const h = document.createElement('div');
    h.className = 'heart-particle';
    h.textContent = 'â™¥';
    h.style.left = (30 + Math.random() * 40) + '%';
    h.style.top = (40 + Math.random() * 20) + '%';
    h.style.animationDelay = (Math.random() * 1) + 's';
    h.style.fontSize = (12 + Math.random() * 16) + 'px';
    $('game').appendChild(h);
    setTimeout(() => h.remove(), 4500);
  }
}

function spawnSparkles(count = 10) {
  for (let i = 0; i < count; i++) {
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.textContent = 'âœ¦';
    s.style.left = (20 + Math.random() * 60) + '%';
    s.style.top = (20 + Math.random() * 40) + '%';
    s.style.animationDelay = (Math.random() * 0.8) + 's';
    $('game').appendChild(s);
    setTimeout(() => s.remove(), 2500);
  }
}

function spawnSakura() {
  for (let i = 0; i < 25; i++) {
    const p = document.createElement('div');
    p.className = 'sakura-petal';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (4 + Math.random() * 4) + 's';
    p.style.animationDelay = Math.random() * 6 + 's';
    $('game').appendChild(p);
    setTimeout(() => p.remove(), 11000);
  }
}

function waitClick() {
  return new Promise(resolve => {
    function handler() {
      if (!skipType()) { document.removeEventListener('click', handler); resolve(); }
    }
    document.addEventListener('click', handler);
  });
}

function showEnding(type, title, text, color) {
  endingScreen.className = 'ending-' + type;
  endingScreen.style.display = 'flex';
  endingScreen.innerHTML = `
    <div class="ending-label" style="color:${color}; opacity:0.6;">â€” ${type.toUpperCase()} END â€”</div>
    <h2 style="color:${color};">${title}</h2>
    <div class="ending-text">${text}</div>
    <div>
      <button class="retry-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦æœ€åˆã‹ã‚‰</button>
      <button class="retry-btn" onclick="location.href='index.html'">ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ç·¨ã¸</button>
    </div>
  `;
  textbox.style.display = 'none';
  character.style.display = 'none';
}

// ========== ãƒ¡ã‚¤ãƒ³ã‚·ãƒŠãƒªã‚ª ==========
async function startGame() {
  await fadeOut();
  titleScreen.style.display = 'none';
  setBg('classroom-morning');
  textbox.style.display = '';
  await fadeIn();

  // === ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° ===
  await typeText('', '3æœˆ14æ—¥ â”€â”€ ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã€‚'); await waitClick();
  await typeText('', 'ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã«ãƒãƒ§ã‚³ã‚’æ¸¡ã—ã¦ã‹ã‚‰ã€ã¡ã‚‡ã†ã©1ãƒ¶æœˆã€‚'); await waitClick();
  await typeText('', 'ã‚ã®æ—¥ã‹ã‚‰ã€ç›¸æ²¢ãã‚“ã¨ã®è·é›¢ã¯ç¢ºå®Ÿã«è¿‘ããªã£ãŸã€‚'); await waitClick();
  await typeText('', 'â€¦â€¦ã§ã‚‚ã€ã¾ã ã€ŒãŠè¿”äº‹ã€ã¯ã‚‚ã‚‰ã£ã¦ã„ãªã„ã€‚'); await waitClick();

  // å›æƒ³
  $('memory-vignette').style.display = '';
  await typeText('', 'â”€â”€ ã‚ã®æ—¥ã®è¨€è‘‰ãŒã€ãšã£ã¨èƒ¸ã®ä¸­ã§éŸ¿ã„ã¦ã„ã‚‹ã€‚'); await waitClick();
  await typeText('ç›¸æ²¢ æ‚ ', 'ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã€çµ¶å¯¾è¿”ã™ã‹ã‚‰ã€‚â€¦â€¦å¾…ã£ã¦ã¦ãã‚Œã€‚ã€'); await waitClick();
  $('memory-vignette').style.display = 'none';

  await typeText('', 'ä»Šæ—¥ãŒãã®æ—¥ã ã€‚'); await waitClick();
  await typeText('', 'æœã®ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ãŒå§‹ã¾ã‚‹å‰ã€‚æ•™å®¤ã«å…¥ã‚‹ã¨â”€â”€'); await waitClick();

  // ã‚­ãƒ£ãƒ©ç™»å ´
  character.style.display = '';
  character.style.opacity = '0';
  setOutfit('school');
  setExpression('nervous');
  setTimeout(() => character.style.opacity = '1', 50);
  trustMeter.style.display = 'flex';

  await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã€‚ãŠã¯ã‚ˆã†ã€‚'); await waitClick();
  await typeText('', 'ç›¸æ²¢ãã‚“ã®å£°ãŒã€ã„ã¤ã‚‚ã‚ˆã‚Šå°‘ã—ç¡¬ã„ã€‚'); await waitClick();
  await typeText('', 'æ‰‹å…ƒã‚’ã¡ã‚‰ã‚Šã¨è¦‹ã‚‹ã¨ã€ã‚«ãƒãƒ³ã‚’å¦™ã«å¤§äº‹ãã†ã«æŠ±ãˆã¦ã„ãŸã€‚'); await waitClick();

  setExpression('shy');
  await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ãˆã£ã¨ã€ä»Šæ—¥ã•ã€‚æ”¾èª²å¾Œã€æ™‚é–“ã‚ã‚‹ã‹ï¼Ÿ'); await waitClick();

  // é¸æŠ1: åå¿œ
  const react = await showChoices([
    { text: 'ã€Œã†ã‚“ã€ç©ºã‘ã¦ã‚ã‚‹ã‚ˆã€ç´ ç›´ã«å¬‰ã—ãã†ã«ç­”ãˆã‚‹', value: 'happy', aff: 10 },
    { text: 'ã€Œâ€¦â€¦ã‚‚ã—ã‹ã—ã¦ã€ä»Šæ—¥ã£ã¦ä½•ã‹ã‚ã£ãŸã£ã‘ï¼Ÿã€ã¨ã¼ã‘ã‚‹', value: 'tease', aff: 5 },
    { text: 'ã€Œæ”¾èª²å¾Œï¼Ÿ â€¦â€¦ã†ã‚“ã€ãƒ‰ã‚­ãƒ‰ã‚­ã‚’éš ã—ã¦é ·ã', value: 'calm', aff: 8 },
  ]);
  updateTrust(react.aff);

  if (react.value === 'happy') {
    setExpression('blush');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ãã£ã‹ã€‚ã‚ˆã‹ã£ãŸã€‚'); await waitClick();
    await typeText('', 'å°‘ã—ã ã‘ã€å®‰å¿ƒã—ãŸã‚ˆã†ãªé¡”ã‚’ã—ãŸã€‚'); await waitClick();
    spawnHearts(3);
  } else if (react.value === 'tease') {
    setExpression('surprise');
    await typeText('ç›¸æ²¢ æ‚ ', 'ãˆâ€¦â€¦ã„ã‚„ã€3æœˆ14æ—¥ã ã‚ã€‚ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã€‚'); await waitClick();
    setExpression('nervous');
    await typeText('ç›¸æ²¢ æ‚ ', 'å¿˜ã‚Œã¦ãŸã®ã‹â€¦â€¦ï¼Ÿ ã„ã‚„ã€ã¾ã‚ã„ã„ã‘ã©ã€‚'); await waitClick();
    await typeText('', 'å°‘ã—ç„¦ã£ãŸé¡”ãŒã€ãªã‚“ã ã‹ãŠã‹ã—ãã¦ç¬‘ã£ã¦ã—ã¾ã£ãŸã€‚'); await waitClick();
    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ç¬‘ã†ãªã‚ˆã€‚'); await waitClick();
  } else {
    setExpression('smile');
    await typeText('ç›¸æ²¢ æ‚ ', 'ãŠã†ã€‚ã˜ã‚ƒã‚ã€æ”¾èª²å¾Œãªã€‚'); await waitClick();
    await typeText('', 'çŸ­ãè¨€ã£ã¦ã€å‰ã‚’å‘ã„ãŸã€‚è€³ãŒå°‘ã—èµ¤ã„ã€‚'); await waitClick();
  }

  await typeText('', 'â”€â”€ ã¾ãŸã€é•·ã„æˆæ¥­ãŒå§‹ã¾ã‚‹ã€‚'); await waitClick();
  await typeText('', 'æ™‚è¨ˆã®é‡ãŒã€ä»Šæ—¥ã‚‚ã‚†ã£ãã‚Šã«æ„Ÿã˜ãŸã€‚'); await waitClick();

  // === æ˜¼ä¼‘ã¿ ===
  await fadeOut();
  setBg('hallway-afternoon');
  character.style.display = 'none';
  await fadeIn();

  await typeText('', 'æ˜¼ä¼‘ã¿ã€‚å‹é”ã«å£°ã‚’ã‹ã‘ã‚‰ã‚ŒãŸã€‚'); await waitClick();
  await typeText('å‹äºº', 'ç›¸æ²¢ãã‚“ã¨æ”¾èª²å¾Œãƒ‡ãƒ¼ãƒˆã§ã—ã‚‡ï¼Ÿ èã„ãŸã‚ˆï½ï¼'); await waitClick();
  await typeText('', 'â€¦â€¦å£°ãŒå¤§ãã„ã€‚'); await waitClick();
  await typeText('å‹äºº', 'ã­ãˆã­ãˆã€ã©ã“è¡Œãã‹èã„ãŸï¼Ÿ'); await waitClick();
  await typeText('', 'é¦–ã‚’æ¨ªã«æŒ¯ã‚‹ã¨ã€å‹äººã¯ã«ã‚„ã‚Šã¨ç¬‘ã£ãŸã€‚'); await waitClick();
  await typeText('å‹äºº', 'ã‚µãƒ—ãƒ©ã‚¤ã‚ºã£ã¦ã‚„ã¤ã‹ã‚‚ã­ã€‚æ¥½ã—ã¿ã ã­ï½'); await waitClick();
  await typeText('', 'â€¦â€¦æ¥½ã—ã¿ã€ã¨ã„ã†ã‹ã€‚ç·Šå¼µã—ã‹ãªã„ã€‚'); await waitClick();

  // === æ”¾èª²å¾Œ - å¾…ã¡åˆã‚ã› ===
  await fadeOut();
  setBg('classroom-morning');
  character.style.display = '';
  setExpression('serious');
  await fadeIn();

  await typeText('', 'æ”¾èª²å¾Œã€‚æ•™å®¤ã«ã¯ã‚‚ã†ã€ã»ã¨ã‚“ã©äººãŒã„ãªã„ã€‚'); await waitClick();
  await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦å¾…ãŸã›ãŸã‹ï¼Ÿ'); await waitClick();
  await typeText('', 'ç›¸æ²¢ãã‚“ãŒåˆ¶æœã®ã¾ã¾â”€â”€ã„ã‚„ã€å°‘ã—ã ã‘èº«ã ã—ãªã¿ã‚’æ•´ãˆã¦ã„ã‚‹ã€‚'); await waitClick();
  await typeText('', 'ãƒã‚¯ã‚¿ã‚¤ãŒã„ã¤ã‚‚ã‚ˆã‚Šãã¡ã‚“ã¨çµã°ã‚Œã¦ã„ã‚‹ã€‚'); await waitClick();

  setExpression('smile');
  await typeText('ç›¸æ²¢ æ‚ ', 'ä»Šæ—¥ã€ã¡ã‚‡ã£ã¨ä»˜ãåˆã£ã¦ãã‚Œã€‚'); await waitClick();

  // é¸æŠ2: ãƒ‡ãƒ¼ãƒˆå…ˆï¼ˆç›¸æ²¢ãŒææ¡ˆã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé¸ã¶ï¼‰
  await typeText('ç›¸æ²¢ æ‚ ', 'è¡ŒããŸã„ã¨ã“ã‚ã€ã‚ã‚‹ã‹ï¼Ÿ ä¿ºã«åˆã‚ã›ã¦ãã‚Œã‚‹ãªã‚‰â€¦â€¦');
  const date = await showChoices([
    { text: 'ã€Œç›¸æ²¢ãã‚“ã«ä»»ã›ã‚‹ã€â”€â”€ å½¼ã®è¨ˆç”»ã‚’ä¿¡ã˜ã‚‹', value: 'trust', aff: 15 },
    { text: 'ã€Œæ°´æ—é¤¨ã«è¡Œã£ã¦ã¿ãŸã„ãªã€â”€â”€ ãšã£ã¨è¡ŒããŸã‹ã£ãŸå ´æ‰€', value: 'aquarium', aff: 10 },
    { text: 'ã€Œã©ã“ã§ã‚‚ã„ã„ã‚ˆã€ä¸€ç·’ãªã‚‰ã€â”€â”€ æ­£ç›´ã«ä¼ãˆã‚‹', value: 'together', aff: 12 },
  ]);
  updateTrust(date.aff);
  state.dateChoice = date.value;

  // === å ´é¢è»¢æ›: ãƒ‡ãƒ¼ãƒˆ ===
  await fadeOut();
  character.style.display = '';
  setOutfit('casual');

  if (date.value === 'aquarium') {
    setBg('aquarium');
    await fadeIn();

    setExpression('smile');
    await typeText('', 'â”€â”€ æ°´æ—é¤¨ã€‚é’ã„å…‰ã«åŒ…ã¾ã‚ŒãŸã€é™ã‹ãªç©ºé–“ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'æ°´æ—é¤¨ã€å¥½ããªã®ã‹ï¼Ÿ'); await waitClick();
    await typeText('', 'ã€Œã†ã‚“ã€‚ãªã‚“ã‹è½ã¡ç€ãã‚“ã ã‚ˆã­ã€'); await waitClick();
    setExpression('grin');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‹ã‚‹ã€‚å¤–ã®ä¸–ç•Œã¨åˆ‡ã‚Šé›¢ã•ã‚ŒãŸæ„Ÿã˜ãŒã„ã„ã‚ˆãªã€‚'); await waitClick();
    await typeText('', 'å¤§ããªæ°´æ§½ã®å‰ã§ã€äºŒäººä¸¦ã‚“ã§ç«‹ã¤ã€‚'); await waitClick();
    await typeText('', 'é’ã„å…‰ãŒç›¸æ²¢ãã‚“ã®æ¨ªé¡”ã‚’ç…§ã‚‰ã—ã¦ã„ã¦ã€'); await waitClick();
    await typeText('', 'ã©ãã£ã¨ã™ã‚‹ãã‚‰ã„ã€ç¶ºéº—ã ã¨æ€ã£ãŸã€‚'); await waitClick();

    // é¸æŠ3: æ°´æ—é¤¨ã§ã®åå¿œ
    await typeText('', 'ã‚¯ãƒ©ã‚²ã®ã‚³ãƒ¼ãƒŠãƒ¼ã§è¶³ã‚’æ­¢ã‚ãŸã€‚ã‚†ã‚‰ã‚†ã‚‰æºã‚Œã‚‹å…‰ã€‚');
    const aquaReact = await showChoices([
      { text: 'ã€Œãã‚Œã„â€¦â€¦ã€æ€ã‚ãšæ‰‹ã‚’ä¼¸ã°ã™ã¨ã€æŒ‡ãŒè§¦ã‚ŒãŸ', value: 'touch', aff: 12 },
      { text: 'ã€Œç›¸æ²¢ãã‚“ã‚‚ã‚¯ãƒ©ã‚²ã¿ãŸã„ã ã­ã€â”€â”€ ã¤ã„å¤‰ãªã“ã¨ã‚’', value: 'joke', aff: 5 },
      { text: 'é™ã‹ã«éš£ã«å¯„ã‚Šæ·»ã†', value: 'close', aff: 10 },
    ]);
    updateTrust(aquaReact.aff);

    if (aquaReact.value === 'touch') {
      setExpression('blush');
      await typeText('', 'æŒ‡å…ˆãŒè§¦ã‚ŒãŸç¬é–“ã€äºŒäººã¨ã‚‚å›ºã¾ã£ãŸã€‚'); await waitClick();
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã£ã€‚'); await waitClick();
      await typeText('', 'ã§ã‚‚â”€â”€é›¢ã•ãªã‹ã£ãŸã€‚'); await waitClick();
      spawnHearts(5);
      await typeText('', 'ãã£ã¨ã€æŒ‡ãŒçµ¡ã¾ã‚‹ã€‚'); await waitClick();
      setExpression('happy');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦æ‰‹ã€å†·ãŸã„ãªã€‚æ¸©ã‚ã¦ã‚„ã‚‹ã€‚'); await waitClick();
    } else if (aquaReact.value === 'joke') {
      setExpression('surprise');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã¯ã‚ï¼Ÿ ã‚¯ãƒ©ã‚²ï¼Ÿ'); await waitClick();
      setExpression('smile');
      await typeText('ç›¸æ²¢ æ‚ ', 'ã©ã†ã„ã†æ„å‘³ã ã‚ˆã€ãã‚Œã€‚'); await waitClick();
      await typeText('', 'ã€Œãµã‚ãµã‚ã—ã¦ã¦ã€è¦‹ã¦ã‚‹ã¨è½ã¡ç€ãã¨ã“ã‚ã€'); await waitClick();
      setExpression('blush');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ãã‚Œè¤’ã‚ã¦ã‚‹ã®ã‹ï¼Ÿ ã¾ã‚â€¦â€¦ã‚ã‚ŠãŒã¨ã†ã€‚'); await waitClick();
    } else {
      setExpression('smile');
      await typeText('', 'è‚©ãŒè§¦ã‚Œã‚‹ãã‚‰ã„ã®è·é›¢ã€‚'); await waitClick();
      await typeText('', 'ä½•ã‚‚è¨€ã‚ãªãã¦ã‚‚ã€å¿ƒåœ°ã„ã„ã€‚'); await waitClick();
      setExpression('blush');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦è¿‘ã„ãªã€‚â€¦â€¦ã„ã‚„ã€ã„ã„ã‘ã©ã€‚'); await waitClick();
    }
  } else {
    // trust / together â†’ ã‚«ãƒ•ã‚§ â†’ å…¬åœ’ã‚³ãƒ¼ã‚¹
    setBg('cafe');
    await fadeIn();

    setExpression('smile');
    await typeText('', 'â”€â”€ é§…å‰ã®å°ã•ãªã‚«ãƒ•ã‚§ã«å…¥ã£ãŸã€‚'); await waitClick();
    await typeText('', 'çª“éš›ã®å¸­ã€‚æ¸©ã‹ã„ã‚«ãƒ•ã‚§ãƒ©ãƒ†ã‚’é ¼ã‚“ã ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ä½•ã«ã™ã‚‹ï¼Ÿ ä»Šæ—¥ã¯ä¿ºãŒå‡ºã™ã‹ã‚‰ã€‚'); await waitClick();

    if (date.value === 'trust') {
      await typeText('', 'ã€Œã‚ã‚ŠãŒã¨ã†ã€‚ã˜ã‚ƒã‚â€¦â€¦ã‚±ãƒ¼ã‚­ã‚»ãƒƒãƒˆã§ã€'); await waitClick();
      setExpression('grin');
      await typeText('ç›¸æ²¢ æ‚ ', 'äº†è§£ã€‚ä¿ºã‚‚åŒã˜ã®ã€‚'); await waitClick();
    } else {
      await typeText('', 'ã€Œä¸€ç·’ã®ã§ã„ã„ã‚ˆã€'); await waitClick();
      setExpression('blush');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ãŠãã‚ã„ã€ã‹ã€‚ã„ã„ãªã€‚'); await waitClick();
    }

    await typeText('', 'ã‚±ãƒ¼ã‚­ã‚’é£Ÿã¹ãªãŒã‚‰ã€ä»–æ„›ã‚‚ãªã„è©±ã‚’ã—ãŸã€‚'); await waitClick();
    await typeText('', 'æœ€è¿‘è¦‹ãŸæ˜ ç”»ã®ã“ã¨ã€‚æ¥é€±ã®ãƒ†ã‚¹ãƒˆã®ã“ã¨ã€‚'); await waitClick();
    await typeText('', 'ãªã‚“ã§ã‚‚ãªã„ä¼šè©±ãŒã€ã“ã‚“ãªã«æ¥½ã—ã„ãªã‚“ã¦ã€‚'); await waitClick();

    // é¸æŠ3: ã‚«ãƒ•ã‚§ã§ã®ä¼šè©±
    await typeText('ç›¸æ²¢ æ‚ ', 'ãªã‚â€¦â€¦ä¸€å€‹ã€èã„ã¦ã‚‚ã„ã„ã‹ï¼Ÿ');
    setExpression('serious');
    await typeText('ç›¸æ²¢ æ‚ ', 'ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã®ã¨ãâ€¦â€¦ã‚ã®ãƒãƒ§ã‚³ã€ã„ã¤ã‹ã‚‰æº–å‚™ã—ã¦ãŸã‚“ã ï¼Ÿ');

    const cafeReact = await showChoices([
      { text: 'ã€Œå‰æ—¥ã®å¤œã«å¿…æ­»ã§ä½œã£ãŸã€â”€â”€ æ­£ç›´ã«è¨€ã†', value: 'honest', aff: 12 },
      { text: 'ã€Œ1é€±é–“ãã‚‰ã„å‰ã‹ã‚‰ç·´ç¿’ã—ã¦ãŸã‚“ã â€¦â€¦ã€', value: 'effort', aff: 15 },
      { text: 'ã€Œç§˜å¯†ã€â”€â”€ å°‘ã—ã ã‘æ„åœ°æ‚ªã«ç¬‘ã†', value: 'secret', aff: 5 },
    ]);
    updateTrust(cafeReact.aff);

    if (cafeReact.value === 'honest') {
      setExpression('surprise');
      await typeText('ç›¸æ²¢ æ‚ ', 'å‰æ—¥!? â€¦â€¦ã§ã‚‚ã€ã™ã”ãç¾å‘³ã—ã‹ã£ãŸãã€‚'); await waitClick();
      setExpression('smile');
      await typeText('ç›¸æ²¢ æ‚ ', 'æ‰èƒ½ã‚ã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã€ãŠè“å­ä½œã‚Šã€‚'); await waitClick();
      spawnHearts(3);
    } else if (cafeReact.value === 'effort') {
      setExpression('blush');
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ä¸€é€±é–“ã€‚'); await waitClick();
      await typeText('', 'ç›¸æ²¢ãã‚“ãŒç›®ã‚’ãã‚‰ã—ãŸã€‚ã§ã‚‚ã€è€³ãŒçœŸã£èµ¤ã ã€‚'); await waitClick();
      await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‚ŠãŒã¨ã†ãªã€‚ãƒã‚¸ã§å¬‰ã—ã‹ã£ãŸã€‚'); await waitClick();
      spawnHearts(5);
    } else {
      setExpression('smile');
      await typeText('ç›¸æ²¢ æ‚ ', 'ç§˜å¯†ã‹â€¦â€¦ã¾ã‚ã€ã„ã¤ã‹æ•™ãˆã¦ãã‚Œã‚ˆã€‚'); await waitClick();
    }
  }

  // === ãŠè¿”ã—ã®å ´é¢ ===
  await fadeOut();
  if (state.trust >= 65) {
    setBg('rooftop-sunset');
  } else if (state.dateChoice === 'aquarium') {
    setBg('park-evening');
  } else {
    setBg('street-night');
  }
  character.style.display = '';
  setExpression('nervous');
  await fadeIn();

  if (state.trust >= 65) {
    await typeText('', 'å¤•æš®ã‚Œã®å±‹ä¸Šã€‚ã‚ã®æ—¥ã¨åŒã˜å ´æ‰€ã€‚'); await waitClick();
    await typeText('', 'ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®ç©ºãŒã€ä¸–ç•Œã‚’å„ªã—ãæŸ“ã‚ã¦ã„ã‚‹ã€‚'); await waitClick();
  } else if (state.dateChoice === 'aquarium') {
    await typeText('', 'æ°´æ—é¤¨ã‚’å‡ºã‚‹ã¨ã€ç©ºãŒç´«ã«æŸ“ã¾ã£ã¦ã„ãŸã€‚'); await waitClick();
    await typeText('', 'è¿‘ãã®å…¬åœ’ã®ãƒ™ãƒ³ãƒã«ä¸¦ã‚“ã§åº§ã‚‹ã€‚'); await waitClick();
  } else {
    await typeText('', 'å¸°ã‚Šé“ã€‚è¡—ç¯ãŒé™ã‹ã«ç¯ã‚Šå§‹ã‚ãŸã€‚'); await waitClick();
    await typeText('', 'ç›¸æ²¢ãã‚“ãŒæ€¥ã«ç«‹ã¡æ­¢ã¾ã£ãŸã€‚'); await waitClick();
  }

  setExpression('serious');
  await typeText('ç›¸æ²¢ æ‚ ', 'â”€â”€ãªã‚ã€‚'); await waitClick();
  await typeText('', 'ç›¸æ²¢ãã‚“ã®å£°ã®ãƒˆãƒ¼ãƒ³ãŒå¤‰ã‚ã£ãŸã€‚'); await waitClick();
  await typeText('ç›¸æ²¢ æ‚ ', '1ãƒ¶æœˆã€å¾…ãŸã›ãŸãªã€‚'); await waitClick();

  setExpression('nervous');
  await typeText('', 'ç›¸æ²¢ãã‚“ãŒã‚«ãƒãƒ³ã‹ã‚‰ä½•ã‹ã‚’å–ã‚Šå‡ºã™ã€‚'); await waitClick();
  await typeText('', 'â”€â”€å°ã•ãªã€ç¶ºéº—ã«åŒ…ã¾ã‚ŒãŸç®±ã€‚'); await waitClick();

  // é¸æŠ4: ãŠè¿”ã—ã®å—ã‘å–ã‚Šæ–¹
  await typeText('', 'å·®ã—å‡ºã•ã‚ŒãŸç®±ã‚’è¦‹ã¦ã€å¿ƒè‡“ãŒè·³ã­ã‚‹ã€‚');
  const receive = await showChoices([
    { text: 'ã€Œâ€¦â€¦é–‹ã‘ã¦ã‚‚ã„ã„ï¼Ÿã€â”€â”€ ä»Šã™ãè¦‹ãŸã„', value: 'open', aff: 10 },
    { text: 'ä¸¡æ‰‹ã§å¤§åˆ‡ã«å—ã‘å–ã‚‹ â”€â”€ è¨€è‘‰ã‚ˆã‚Šå…ˆã«ã€æ°—æŒã¡ã§', value: 'careful', aff: 15 },
    { text: 'ã€ŒãŠè¿”ã—â€¦â€¦ã£ã¦ã“ã¨ã¯ã€â”€â”€ ç­”ãˆã‚’èããŸã„', value: 'answer', aff: 12 },
  ]);
  updateTrust(receive.aff);
  state.giftChoice = receive.value;

  await showGift('ğŸ');
  spawnSparkles(8);

  if (receive.value === 'open') {
    setExpression('blush');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‚ã€‚é–‹ã‘ã¦ãã‚Œã€‚'); await waitClick();
    await typeText('', 'åŒ…ã¿ã‚’è§£ãã¨ã€ä¸­ã«ã¯â”€â”€'); await waitClick();
  } else if (receive.value === 'careful') {
    setExpression('happy');
    await typeText('', 'ä¸¡æ‰‹ã§ãã£ã¨å—ã‘å–ã£ãŸã€‚æ¸©ã‹ã„ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦é–‹ã‘ã¦ã¿ã¦ãã‚Œã€‚'); await waitClick();
    await typeText('', 'ä¸å¯§ã«ãƒªãƒœãƒ³ã‚’ã»ã©ãã€‚ä¸­ã«ã¯â”€â”€'); await waitClick();
  } else {
    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã¾ã‚ã€ã¨ã‚Šã‚ãˆãšé–‹ã‘ã‚ã‚ˆã€‚'); await waitClick();
    await typeText('', 'å°‘ã—ç„¦ã£ãŸã‚ˆã†ã«ä¿ƒã•ã‚Œã¦ã€ç®±ã‚’é–‹ã‘ã‚‹ã€‚ä¸­ã«ã¯â”€â”€'); await waitClick();
  }

  // ===== ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°åˆ†å² =====
  if (state.trust >= 70) {
    // TRUE END
    spawnHearts(10);
    await showGift('ğŸ’');

    await typeText('', 'ç¹Šç´°ãªãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå…¥ã£ã¦ã„ãŸã€‚'); await waitClick();
    await typeText('', 'éŠ€è‰²ã®ç´°ã„ãƒªãƒ³ã‚°ã«ã€å°ã•ãªçŸ³ãŒã²ã¨ã¤ã€‚'); await waitClick();

    setExpression('blush');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚¯ãƒƒã‚­ãƒ¼ã¨ã‹ãƒã‚·ãƒ¥ãƒãƒ­ã¨ã‹ã‚‚è€ƒãˆãŸã‚“ã ã‘ã©ã•ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ã‚ã®ãƒãƒ§ã‚³ã‚‚ã‚‰ã£ãŸæ™‚ã€å½¢ã«æ®‹ã‚‹ã‚‚ã®ã§è¿”ã—ãŸã„ã£ã¦æ€ã£ã¦ã€‚'); await waitClick();
    setExpression('happy');

    // CGæ¼”å‡º
    if (state.trust >= 65) {
      cgOverlay.className = 'cg-fireworks';
      cgOverlay.style.display = 'flex';
      cgOverlay.style.opacity = '0';
      setTimeout(() => cgOverlay.style.opacity = '1', 50);
    }

    await typeText('ç›¸æ²¢ æ‚ ', 'æ”¹ã‚ã¦è¨€ã‚ã›ã¦ãã‚Œã€‚'); await waitClick();
    spawnSakura();
    spawnHearts(20);

    await typeText('ç›¸æ²¢ æ‚ ', 'â”€â”€ å¥½ãã ã€‚ã“ã‚Œã‹ã‚‰ã‚‚ã€ãšã£ã¨éš£ã«ã„ã¦ã»ã—ã„ã€‚'); await waitClick();
    await typeText('', 'â€¦â€¦â€¦â€¦ã€‚'); await waitClick();
    await typeText('', 'æ¶™ãŒæ­¢ã¾ã‚‰ãªã‹ã£ãŸã€‚'); await waitClick();
    await typeText('', 'ã€Œâ€¦â€¦ç§ã‚‚ã€‚ãšã£ã¨ã€ãšã£ã¨å¥½ãã ã‚ˆã€'); await waitClick();

    setExpression('happy');
    await typeText('', 'æŒ‡ã«ãƒªãƒ³ã‚°ã‚’ã¯ã‚ã¦ãã‚ŒãŸç›¸æ²¢ãã‚“ã®æ‰‹ã¯ã€å°‘ã—éœ‡ãˆã¦ã„ãŸã€‚'); await waitClick();
    spawnHearts(15);
    await typeText('', 'å¤•ç„¼ã‘ã®ä¸­ã€äºŒäººã®å½±ãŒé‡ãªã‚‹ã€‚'); await waitClick();
    await typeText('', 'â”€â”€ ã“ã®æ‰‹ã‚’ã€ã‚‚ã†é›¢ã•ãªã„ã€‚'); await waitClick();

    await fadeOut();
    showEnding('true', 'æ°¸é ã®ãƒªãƒ³ã‚°',
      'ã‚ã®æ—¥ã®ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã¯ã€<br>ã“ã‚“ãªã«ã‚‚ç¾ã—ã„å½¢ã«ãªã£ã¦è¿”ã£ã¦ãã¾ã—ãŸã€‚<br><br>ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã«å§‹ã¾ã£ãŸç‰©èªã¯ã€<br>ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã«ç­”ãˆåˆã‚ã›ã‚’è¿ãˆâ”€â”€<br><br>ãã—ã¦ã“ã‚Œã‹ã‚‰ã‚‚ã€ãšã£ã¨ç¶šã„ã¦ã„ãã¾ã™ã€‚',
      '#B8A9FF');
    spawnHearts(20);
    setInterval(() => { spawnHearts(5); spawnSakura(); }, 3000);

  } else if (state.trust >= 45) {
    // SWEET END
    spawnSparkles(12);
    await showGift('ğŸ§');

    await typeText('', 'æ‰‹ä½œã‚Šã®ã‚«ãƒƒãƒ—ã‚±ãƒ¼ã‚­ãŒå…¥ã£ã¦ã„ãŸã€‚'); await waitClick();
    await typeText('', 'å°‘ã—ä¸æ ¼å¥½ã ã‘ã©ã€ä¸å¯§ã«ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¦ã„ã‚‹ã€‚'); await waitClick();

    setExpression('nervous');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ç¬‘ã†ãªã‚ˆã€‚åˆã‚ã¦ä½œã£ãŸã‚“ã ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ãŠå‰ãŒæ‰‹ä½œã‚Šã—ã¦ãã‚ŒãŸã‹ã‚‰ã€ä¿ºã‚‚è‡ªåˆ†ã§ä½œã‚ŠãŸãã¦ã€‚'); await waitClick();

    setExpression('blush');
    await typeText('ç›¸æ²¢ æ‚ ', '3å›ãã‚‰ã„å¤±æ•—ã—ã¦ã€ã‚„ã£ã¨ã“ã‚ŒãŒã€‚'); await waitClick();
    await typeText('', 'ã€Œâ€¦â€¦3å›ã‚‚ï¼Ÿã€'); await waitClick();
    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'ã†ã‚‹ã•ã„ãªã€‚æ°—æŒã¡ã®å•é¡Œã ã‚ã€‚'); await waitClick();
    spawnHearts(8);
    await typeText('', 'ãã®ä¸å™¨ç”¨ã•ãŒã€ãŸã¾ã‚‰ãªãæ„›ãŠã—ã‹ã£ãŸã€‚'); await waitClick();
    await typeText('', 'ã€Œã‚ã‚ŠãŒã¨ã†ã€‚é£Ÿã¹ã‚‹ã®æ¥½ã—ã¿ã€'); await waitClick();
    setExpression('smile');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã¨ã€‚ã“ã‚Œã‹ã‚‰ã‚‚ã‚ˆã‚ã—ããªã€‚å½¼å¥³ã¨ã—ã¦ã€‚'); await waitClick();
    await typeText('', 'ã•ã‚‰ã£ã¨è¨€ã£ãŸãã›ã«ã€ç›®ã‚’åˆã‚ã›ã¦ãã‚Œãªã„ã€‚'); await waitClick();
    spawnHearts(10);
    await typeText('', 'â”€â”€ ç”˜ã„ç”˜ã„ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼ã€‚'); await waitClick();

    await fadeOut();
    showEnding('sweet', 'ä¸å™¨ç”¨ãªæ‰‹ä½œã‚Š',
      '3å›å¤±æ•—ã—ãŸã‚«ãƒƒãƒ—ã‚±ãƒ¼ã‚­ã€‚<br>ãã®ä¸å™¨ç”¨ãªå„ªã—ã•ãŒã€ä½•ã‚ˆã‚Šã‚‚å¬‰ã—ã‹ã£ãŸã€‚<br><br>ã¾ã ãã“ã¡ãªã„ã‘ã‚Œã©ã€<br>äºŒäººã®æ­©å¹…ã¯å°‘ã—ãšã¤æƒã£ã¦ã„ãã€‚<br><br>æ˜¥ãŒæ¥ã‚‹ã€‚äºŒäººã®æ˜¥ãŒã€‚',
      '#87CEEB');
    spawnHearts(10);
    setInterval(() => spawnHearts(3), 3000);

  } else {
    // BITTERSWEET END
    await showGift('ğŸª');

    await typeText('', 'ç¶ºéº—ã«ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸã‚¯ãƒƒã‚­ãƒ¼ã®è©°ã‚åˆã‚ã›ã€‚'); await waitClick();
    await typeText('', 'å¸‚è²©ã®ã‚‚ã®ã ã‘ã©ã€é¸ã³æŠœã‹ã‚ŒãŸæ„Ÿã˜ãŒã™ã‚‹ã€‚'); await waitClick();

    setExpression('shy');
    await typeText('ç›¸æ²¢ æ‚ ', 'â€¦â€¦ã‚ã‚ŠãŒã¨ã†ãªã€ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã€‚å¬‰ã—ã‹ã£ãŸã‚ˆã€‚'); await waitClick();
    await typeText('', 'ã€Œã†ã‚“ã€'); await waitClick();
    setExpression('serious');
    await typeText('ç›¸æ²¢ æ‚ ', 'æ­£ç›´ã€ã¾ã è‡ªåˆ†ã®æ°—æŒã¡ãŒã‚ˆãã‚ã‹ã£ã¦ãªã„ã€‚'); await waitClick();
    await typeText('ç›¸æ²¢ æ‚ ', 'ã§ã‚‚ã€ãŠå‰ã¨ä¸€ç·’ã«ã„ã‚‹ã¨æ¥½ã—ã„ã®ã¯æœ¬å½“ã ã€‚'); await waitClick();
    setExpression('smile');
    await typeText('ç›¸æ²¢ æ‚ ', 'ã‚‚ã†ã¡ã‚‡ã£ã¨ã ã‘ã€æ™‚é–“ãã‚Œãªã„ã‹ã€‚'); await waitClick();
    await typeText('', 'â”€â”€ ç­”ãˆã¯ã¾ã ã€ã‚‚ã†å°‘ã—å…ˆã€‚'); await waitClick();
    await typeText('', 'ã§ã‚‚ã€é€²ã‚“ã§ã„ãªã„ã‚ã‘ã˜ã‚ƒãªã„ã€‚'); await waitClick();
    await typeText('', 'ã‚¯ãƒƒã‚­ãƒ¼ã‚’å™›ã˜ã‚‹ã¨ã€ãƒã‚¿ãƒ¼ã®å„ªã—ã„å‘³ãŒã—ãŸã€‚'); await waitClick();

    await fadeOut();
    showEnding('bittersweet', 'ã‚‚ã†å°‘ã—ã ã‘',
      'ã¾ã ç­”ãˆã¯å‡ºã¦ã„ãªã„ã€‚<br>ã§ã‚‚ã€æ‹’çµ¶ã§ã‚‚ãªã„ã€‚<br><br>å°‘ã—ãšã¤ã€ã‚†ã£ãã‚Šã¨ã€‚<br>ã“ã®è·é›¢ã‚’è©°ã‚ã¦ã„ã‘ãŸã‚‰ã€‚<br><br>æ¬¡ã®å­£ç¯€ãŒæ¥ã‚‹é ƒã«ã¯ã€ãã£ã¨â”€â”€',
      '#8899BB');
  }
}

// ã‚¿ã‚¤ãƒˆãƒ«ã‚¯ãƒªãƒƒã‚¯
titleScreen.addEventListener('click', () => {
  if (state.phase === 'title') {
    state.phase = 'game';
    startGame();
  }
});
</script>
</body>
</html>
